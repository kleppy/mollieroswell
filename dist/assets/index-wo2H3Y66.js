var C=Object.defineProperty;var E=(p,s,t)=>s in p?C(p,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[s]=t;var y=(p,s,t)=>E(p,typeof s!="symbol"?s+"":s,t);import{r as M,g as v}from"./phaser-Czz4FBZH.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function e(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();var D=M();const u=v(D);class A extends u.Scene{constructor(){super({key:"TitleScene"})}create(){const s=this.scale.width,t=this.scale.height;this.add.rectangle(s/2,t/2,s,t,526360);const e=this.add.graphics();for(let o=0;o<120;o++){const n=Math.random()*s,f=Math.random()*t,d=Math.random()<.8?1:2;e.fillStyle(16777215,.2+Math.random()*.5),e.fillCircle(n,f,d)}const i=this.add.text(s/2,t/2-120,"Mollie vs. Roswell",{fontSize:"48px",color:"#ffdd44",stroke:"#000000",strokeThickness:6,fontStyle:"bold"}).setOrigin(.5).setAlpha(0).setY(t/2-90),l=this.add.text(s/2,t/2-52,"Treat Heist",{fontSize:"30px",color:"#ff8844",stroke:"#000000",strokeThickness:4,fontStyle:"italic"}).setOrigin(.5).setAlpha(0),r=this.add.text(s/2,t/2+8,`Help Mollie the dachshund steal every treat
before Roswell the watchdog catches her!`,{fontSize:"14px",color:"#cccccc",stroke:"#000000",strokeThickness:2,align:"center"}).setOrigin(.5).setAlpha(0),a=this.add.text(s/2,t/2+72,"WASD / Arrow Keys — Move     Space — Drop Poop     M — Mute",{fontSize:"13px",color:"#aaaacc",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setAlpha(0),c=this.add.text(s/2,t/2+120,"Click or press any key to start",{fontSize:"18px",color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:i,alpha:1,y:t/2-120,duration:700,ease:"Back.Out"}),this.tweens.add({targets:l,alpha:1,duration:500,delay:500}),this.tweens.add({targets:[r,a],alpha:1,duration:400,delay:900}),this.tweens.add({targets:c,alpha:1,duration:300,delay:1200,onComplete:()=>{this.tweens.add({targets:c,alpha:.25,duration:700,yoyo:!0,repeat:-1,ease:"Sine.InOut"})}}),this.tweens.add({targets:i,y:t/2-116,duration:1800,yoyo:!0,repeat:-1,ease:"Sine.InOut",delay:900});const h=()=>{this.input.off("pointerdown",h),this.scene.start("GameScene",{level:1})};this.input.once("pointerdown",h),this.input.keyboard.once("keydown",h)}}const S=200,T=120,K=150,G=48,R=250,k=35,P=1e4,O=2e3,x=3e3,F=3e3,b=20,_=3,L={name:"The House",worldWidth:1024,worldHeight:768,totalTreats:20,playerStart:{x:80,y:660},enemyStart:{x:200,y:300},audioFrequency:200,walls:[{x:0,y:0,w:1024,h:20},{x:0,y:748,w:1024,h:20},{x:0,y:0,w:20,h:768},{x:1004,y:0,w:20,h:768},{x:20,y:392,w:130,h:16},{x:374,y:20,w:16,h:80},{x:374,y:220,w:16,h:200},{x:490,y:20,w:16,h:400},{x:490,y:580,w:16,h:168}],furniture:[{rect:{x:30,y:50,w:180,h:70},textureKey:"furniture-couch"},{rect:{x:50,y:240,w:120,h:80},textureKey:"furniture-table"},{rect:{x:295,y:50,w:70,h:120},textureKey:"furniture-bookshelf"},{rect:{x:40,y:450,w:140,h:100},textureKey:"furniture-kitchen-table"},{rect:{x:550,y:60,w:80,h:80},textureKey:"bush"},{rect:{x:740,y:80,w:90,h:90},textureKey:"bush"},{rect:{x:750,y:480,w:90,h:70},textureKey:"bush"},{rect:{x:870,y:620,w:120,h:120},textureKey:"bush-shed"}],treatPositions:[{x:220,y:65},{x:330,y:80},{x:280,y:180},{x:200,y:310},{x:80,y:420},{x:220,y:510},{x:70,y:700},{x:660,y:90},{x:850,y:160},{x:950,y:690},{x:340,y:300},{x:390,y:500},{x:160,y:140},{x:130,y:680},{x:250,y:700},{x:610,y:250},{x:760,y:350},{x:900,y:400},{x:630,y:700},{x:820,y:700}],patrolWaypoints:[{x:200,y:300},{x:390,y:130},{x:390,y:600},{x:150,y:600},{x:150,y:490},{x:620,y:400},{x:800,y:200},{x:920,y:600},{x:620,y:680}],tilePainter:(p,s)=>{const t=s*32,e=p*32;return t>=506?1:t>=374?4:e>=408?3:2}},N={name:"Water Park",worldWidth:1280,worldHeight:960,totalTreats:25,playerStart:{x:700,y:800},enemyStart:{x:700,y:400},audioFrequency:600,walls:[{x:0,y:0,w:1280,h:20},{x:0,y:940,w:1280,h:20},{x:0,y:0,w:20,h:960},{x:1260,y:0,w:20,h:960}],furniture:[{rect:{x:100,y:200,w:380,h:260},textureKey:"wpark-pool"},{rect:{x:120,y:700,w:200,h:160},textureKey:"wpark-wading"},{rect:{x:580,y:160,w:120,h:120},textureKey:"wpark-slide"},{rect:{x:900,y:80,w:160,h:120},textureKey:"wpark-snack"},{rect:{x:1060,y:380,w:120,h:140},textureKey:"wpark-cabin"},{rect:{x:1060,y:600,w:120,h:140},textureKey:"wpark-cabin"},{rect:{x:120,y:120,w:60,h:20},textureKey:"wpark-lounge"},{rect:{x:220,y:120,w:60,h:20},textureKey:"wpark-lounge"},{rect:{x:320,y:120,w:60,h:20},textureKey:"wpark-lounge"},{rect:{x:420,y:120,w:60,h:20},textureKey:"wpark-lounge"},{rect:{x:120,y:480,w:60,h:20},textureKey:"wpark-lounge"},{rect:{x:220,y:480,w:60,h:20},textureKey:"wpark-lounge"},{rect:{x:320,y:480,w:60,h:20},textureKey:"wpark-lounge"},{rect:{x:520,y:240,w:20,h:60},textureKey:"wpark-lounge"},{rect:{x:520,y:340,w:20,h:60},textureKey:"wpark-lounge"}],treatPositions:[{x:55,y:100},{x:55,y:580},{x:55,y:850},{x:250,y:600},{x:380,y:600},{x:510,y:100},{x:510,y:350},{x:510,y:600},{x:700,y:100},{x:700,y:350},{x:700,y:600},{x:700,y:850},{x:840,y:250},{x:840,y:450},{x:840,y:650},{x:840,y:850},{x:1e3,y:260},{x:1e3,y:530},{x:1200,y:200},{x:1200,y:500},{x:1200,y:760},{x:350,y:850},{x:250,y:850},{x:550,y:850},{x:950,y:850}],patrolWaypoints:[{x:60,y:100},{x:60,y:580},{x:60,y:880},{x:350,y:880},{x:700,y:880},{x:1200,y:880},{x:1200,y:100},{x:700,y:100},{x:700,y:520},{x:350,y:100}],tilePainter:(p,s)=>1},W={name:"City Park",worldWidth:1280,worldHeight:960,totalTreats:28,playerStart:{x:100,y:860},enemyStart:{x:640,y:480},audioFrequency:400,walls:[{x:0,y:0,w:1280,h:20},{x:0,y:940,w:1280,h:20},{x:0,y:0,w:20,h:960},{x:1260,y:0,w:20,h:960}],furniture:[{rect:{x:540,y:420,w:120,h:120},textureKey:"park-fountain"},{rect:{x:820,y:60,w:280,h:200},textureKey:"park-pond"},{rect:{x:80,y:80,w:44,h:44},textureKey:"park-tree"},{rect:{x:180,y:60,w:44,h:44},textureKey:"park-tree"},{rect:{x:130,y:160,w:44,h:44},textureKey:"park-tree"},{rect:{x:460,y:80,w:44,h:44},textureKey:"park-tree"},{rect:{x:560,y:60,w:44,h:44},textureKey:"park-tree"},{rect:{x:1080,y:300,w:44,h:44},textureKey:"park-tree"},{rect:{x:1160,y:260,w:44,h:44},textureKey:"park-tree"},{rect:{x:1120,y:380,w:44,h:44},textureKey:"park-tree"},{rect:{x:1e3,y:760,w:44,h:44},textureKey:"park-tree"},{rect:{x:1100,y:800,w:44,h:44},textureKey:"park-tree"},{rect:{x:200,y:380,w:80,h:28},textureKey:"park-bench"},{rect:{x:200,y:520,w:80,h:28},textureKey:"park-bench"},{rect:{x:760,y:400,w:80,h:28},textureKey:"park-bench"},{rect:{x:760,y:580,w:80,h:28},textureKey:"park-bench"},{rect:{x:540,y:700,w:80,h:28},textureKey:"park-bench"},{rect:{x:80,y:680,w:120,h:60},textureKey:"park-swings"},{rect:{x:240,y:720,w:120,h:80},textureKey:"park-sandbox"}],treatPositions:[{x:60,y:300},{x:60,y:500},{x:60,y:700},{x:300,y:100},{x:400,y:200},{x:400,y:400},{x:400,y:600},{x:400,y:800},{x:640,y:200},{x:640,y:320},{x:640,y:580},{x:640,y:720},{x:640,y:880},{x:750,y:200},{x:880,y:320},{x:1e3,y:200},{x:1e3,y:480},{x:1e3,y:650},{x:1200,y:400},{x:1200,y:600},{x:1200,y:800},{x:200,y:880},{x:400,y:880},{x:500,y:820},{x:700,y:880},{x:900,y:880},{x:1100,y:680},{x:1200,y:100}],patrolWaypoints:[{x:640,y:480},{x:350,y:300},{x:100,y:300},{x:100,y:600},{x:420,y:800},{x:640,y:880},{x:950,y:800},{x:1200,y:600},{x:1200,y:300},{x:750,y:100},{x:350,y:100}],tilePainter:(p,s)=>{const t=p*32;return t<60||t>900?4:1}},B={name:"City Streets",worldWidth:1280,worldHeight:960,totalTreats:30,playerStart:{x:400,y:480},enemyStart:{x:790,y:480},audioFrequency:100,walls:[{x:0,y:0,w:1280,h:20},{x:0,y:940,w:1280,h:20},{x:0,y:0,w:20,h:960},{x:1260,y:0,w:20,h:960}],furniture:[{rect:{x:80,y:120,w:240,h:260},textureKey:"city-building"},{rect:{x:480,y:120,w:200,h:220},textureKey:"city-building"},{rect:{x:900,y:120,w:240,h:260},textureKey:"city-building"},{rect:{x:80,y:580,w:240,h:260},textureKey:"city-building"},{rect:{x:480,y:580,w:200,h:260},textureKey:"city-building"},{rect:{x:900,y:580,w:240,h:260},textureKey:"city-building"},{rect:{x:325,y:140,w:50,h:90},textureKey:"city-car"},{rect:{x:325,y:260,w:50,h:90},textureKey:"city-car"},{rect:{x:325,y:600,w:50,h:90},textureKey:"city-car"},{rect:{x:325,y:720,w:50,h:90},textureKey:"city-car"},{rect:{x:840,y:140,w:50,h:90},textureKey:"city-car"},{rect:{x:840,y:260,w:50,h:90},textureKey:"city-car"}],treatPositions:[{x:400,y:60},{x:600,y:60},{x:790,y:60},{x:400,y:200},{x:400,y:320},{x:600,y:200},{x:600,y:350},{x:790,y:200},{x:790,y:350},{x:1100,y:60},{x:1100,y:200},{x:1100,y:400},{x:400,y:480},{x:600,y:480},{x:790,y:480},{x:1100,y:480},{x:60,y:480},{x:60,y:200},{x:60,y:700},{x:400,y:600},{x:400,y:750},{x:600,y:680},{x:790,y:680},{x:1100,y:600},{x:1100,y:760},{x:400,y:890},{x:600,y:890},{x:790,y:890},{x:1100,y:890},{x:60,y:890}],patrolWaypoints:[{x:400,y:60},{x:790,y:60},{x:1200,y:60},{x:1200,y:480},{x:1200,y:890},{x:790,y:890},{x:400,y:890},{x:60,y:890},{x:60,y:480},{x:60,y:60}],tilePainter:(p,s)=>{const t=s*32,e=p*32;return t<80||t>1180||e<80||e>880?2:1}},w=[L,N,W,B];class H{constructor(s,t,e){y(this,"sprite");y(this,"poops");y(this,"scene");y(this,"cursors");y(this,"wasd");y(this,"spaceKey");y(this,"poopCharges",_);y(this,"treatCount",0);y(this,"facingRight",!0);y(this,"shadow");if(this.scene=s,!s.textures.exists("player")){const c=s.add.graphics();for(let o=0;o<4;o++){const n=o*28,f=o===1?2:o===3?-2:0;c.fillStyle(1378820),c.fillEllipse(n+2,8,4,3),c.fillEllipse(n+1,6,3,2),c.fillStyle(1378820),c.fillEllipse(n+13,9,22,11),c.fillStyle(656900),c.fillEllipse(n+12,7,18,5),c.fillStyle(12613680),c.fillEllipse(n+12,9,14,5),c.fillStyle(13377568),c.fillRect(n+18,7,4,2),c.fillStyle(1707270),c.fillEllipse(n+7,2+f,5,7),c.fillEllipse(n+7,16-f,5,7),c.fillStyle(11165728),c.fillEllipse(n+7,4+f,3,3),c.fillEllipse(n+7,14-f,3,3),c.fillStyle(1707270),c.fillEllipse(n+19,2-f,5,7),c.fillEllipse(n+19,16+f,5,7),c.fillStyle(11165728),c.fillEllipse(n+19,4-f,3,3),c.fillEllipse(n+19,14+f,3,3),c.fillStyle(1050631),c.fillEllipse(n+21,2,7,8),c.fillEllipse(n+21,16,7,8),c.fillStyle(8010264),c.fillEllipse(n+21,3,4,5),c.fillEllipse(n+21,15,4,5),c.fillStyle(3809296),c.fillCircle(n+23,9,6),c.fillStyle(12613680),c.fillEllipse(n+23,9,7,6),c.fillStyle(13666360),c.fillCircle(n+21,5,1.5),c.fillCircle(n+21,13,1.5),c.fillStyle(2757640),c.fillEllipse(n+27,9,5,3),c.fillStyle(525570),c.fillEllipse(n+27,9,3,2),c.fillStyle(6307888),c.fillRect(n+26,8,1,1),c.fillStyle(657930),c.fillCircle(n+22,5,2),c.fillCircle(n+22,13,2),c.fillStyle(16777215),c.fillRect(n+23,4,1,1),c.fillRect(n+23,12,1,1)}c.generateTexture("player",112,18),c.destroy();const h=s.textures.get("player");for(let o=0;o<4;o++)h.add(o,0,o*28,0,28,18)}if(s.anims.exists("player-walk")||s.anims.create({key:"player-walk",frames:[0,1,2,3].map(l=>({key:"player",frame:l})),frameRate:8,repeat:-1}),s.anims.exists("player-idle")||s.anims.create({key:"player-idle",frames:[{key:"player",frame:0}],frameRate:1,repeat:0}),!s.textures.exists("poop")){const l=s.add.graphics();l.fillStyle(5909002),l.fillEllipse(8,14,14,6),l.fillStyle(7025425),l.fillEllipse(8,10,11,7),l.fillStyle(8010776),l.fillEllipse(8,6.5,8,6),l.fillStyle(9062434),l.fillEllipse(8,3,5,5),l.fillStyle(13398084),l.fillEllipse(6.5,1.5,2.5,2),l.fillStyle(16777215),l.fillCircle(5,10,2),l.fillCircle(11,10,2),l.fillStyle(1118481),l.fillCircle(5,10,1),l.fillCircle(11,10,1),l.fillStyle(16777215),l.fillRect(5,9,1,1),l.fillRect(11,9,1,1),l.generateTexture("poop",16,16),l.destroy()}this.shadow=s.add.ellipse(t,e+6,20,7,0,.25),this.sprite=s.physics.add.sprite(t,e,"player",0),this.sprite.body.setSize(20,12,!0),this.sprite.setDepth(e),this.sprite.setCollideWorldBounds(!0),this.poops=s.physics.add.staticGroup();const i=s.input.keyboard;this.cursors=i.createCursorKeys(),this.wasd={up:i.addKey(u.Input.Keyboard.KeyCodes.W),down:i.addKey(u.Input.Keyboard.KeyCodes.S),left:i.addKey(u.Input.Keyboard.KeyCodes.A),right:i.addKey(u.Input.Keyboard.KeyCodes.D)},this.spaceKey=i.addKey(u.Input.Keyboard.KeyCodes.SPACE)}update(){const s=this.cursors.left.isDown||this.wasd.left.isDown,t=this.cursors.right.isDown||this.wasd.right.isDown,e=this.cursors.up.isDown||this.wasd.up.isDown,i=this.cursors.down.isDown||this.wasd.down.isDown;let l=0,r=0;s&&(l-=S),t&&(l+=S),e&&(r-=S),i&&(r+=S),l!==0&&r!==0&&(l*=.707,r*=.707),this.sprite.setVelocity(l,r),l>0?this.facingRight=!0:l<0&&(this.facingRight=!1),this.sprite.setFlipX(!this.facingRight),l!==0||r!==0?this.sprite.anims.play("player-walk",!0):(this.sprite.anims.stop(),this.sprite.setFrame(0)),this.sprite.setDepth(this.sprite.y),this.shadow.setPosition(this.sprite.x,this.sprite.y+6),this.shadow.setDepth(this.sprite.y-.5),u.Input.Keyboard.JustDown(this.spaceKey)&&this.poopCharges>0&&this.dropPoop()}dropPoop(){this.poopCharges--;const s=this.poops.create(this.sprite.x,this.sprite.y,"poop");s.setDepth(4),s.refreshBody(),this.scene.time.delayedCall(P,()=>{s.active&&s.destroy()})}collectTreat(){this.treatCount++}getPoopCharges(){return this.poopCharges}getTreatCount(){return this.treatCount}}class I{constructor(s,t,e){y(this,"sprite");y(this,"shadow");y(this,"visionGraphics");y(this,"state","PATROL");y(this,"waypointIndex",0);y(this,"facingAngle",0);y(this,"lastSeenPos",new u.Math.Vector2(0,0));y(this,"losTimer",0);y(this,"searchTimer",0);y(this,"stunTimer",0);y(this,"obstacles",[]);y(this,"waypoints",[]);if(!s.textures.exists("enemy")){const a=s.add.graphics();for(let h=0;h<4;h++){const o=h*18,n=h===1?2:h===3?-2:0;a.fillStyle(11567120),a.fillEllipse(o+3,4,5,9),a.fillEllipse(o+15,4,5,9),a.fillStyle(13408304),a.fillEllipse(o+3,4,3,6),a.fillEllipse(o+15,4,3,6),a.fillStyle(13936672),a.fillCircle(o+9,5,5),a.fillStyle(11567120),a.fillRect(o+6,2,2,1),a.fillRect(o+10,2,2,1),a.fillStyle(1710618),a.fillCircle(o+7,4,1.5),a.fillCircle(o+11,4,1.5),a.fillStyle(16777215),a.fillRect(o+8,3,1,1),a.fillRect(o+12,3,1,1),a.fillStyle(2758664),a.fillEllipse(o+9,8,4,2.5),a.fillStyle(13936672),a.fillEllipse(o+9,16,9,14),a.fillStyle(11569176),a.fillRect(o+5,12,8,1),a.fillRect(o+5,15,8,1),a.fillStyle(10514448),a.fillCircle(o+7,13,1),a.fillCircle(o+11,17,1),a.fillCircle(o+8,19,.8),a.fillStyle(12619792),a.fillEllipse(o+3,14+n,4,7),a.fillEllipse(o+15,14-n,4,7),a.fillStyle(14737648),a.fillRect(o+1,20,4,5),a.fillRect(o+13,20,4,5),a.fillStyle(15790328),a.fillEllipse(o+9,24,14,10),a.fillStyle(13158624),a.fillRect(o+2,21,14,1),a.fillStyle(13684968),a.fillRect(o+3,20,12,1),a.fillStyle(12619792),a.fillEllipse(o+4,25-n,4,5),a.fillEllipse(o+14,25+n,4,5),a.fillStyle(13936672),a.fillCircle(o+15,13,2),a.fillCircle(o+16,11,1.5)}a.generateTexture("enemy",72,28),a.destroy();const c=s.textures.get("enemy");for(let h=0;h<4;h++)c.add(h,0,h*18,0,18,28)}s.anims.exists("enemy-walk")||s.anims.create({key:"enemy-walk",frames:[0,1,2,3].map(i=>({key:"enemy",frame:i})),frameRate:6,repeat:-1}),s.anims.exists("enemy-idle")||s.anims.create({key:"enemy-idle",frames:[{key:"enemy",frame:0}],frameRate:1,repeat:0}),this.shadow=s.add.ellipse(t,e+10,16,6,0,.22),this.sprite=s.physics.add.sprite(t,e,"enemy",0),this.sprite.body.setSize(16,24,!0),this.sprite.setDepth(e),this.sprite.setCollideWorldBounds(!0),this.visionGraphics=s.add.graphics()}setObstacles(s){this.obstacles=s}setWaypoints(s){this.waypoints=s}stun(){this.state="STUNNED",this.stunTimer=O}getState(){return this.state}update(s,t,e){if(this.state==="STUNNED"){this.stunTimer-=s,this.stunTimer<=0&&(this.state="PATROL");const l=this.waypoints[this.waypointIndex]??{x:this.sprite.x,y:this.sprite.y};this.moveToward(l.x,l.y,G),this.updateAnimAndDepth(),this.drawVisionCone();return}switch(this.canSeePlayer(t,e)?(this.state="CHASE",this.lastSeenPos.set(t,e),this.losTimer=0):this.state==="CHASE"&&(this.losTimer+=s,this.losTimer>=F&&(this.state="SEARCH",this.searchTimer=x,this.losTimer=0)),this.state){case"PATROL":this.updatePatrol();break;case"CHASE":this.moveToward(t,e,K);break;case"SEARCH":this.updateSearch(s);break}this.updateAnimAndDepth(),this.drawVisionCone()}updateAnimAndDepth(){const s=this.sprite.body.velocity;Math.abs(s.x)>1||Math.abs(s.y)>1?this.sprite.anims.play("enemy-walk",!0):(this.sprite.anims.stop(),this.sprite.setFrame(0)),this.sprite.setFlipX(Math.cos(this.facingAngle)<0),this.sprite.setDepth(this.sprite.y),this.shadow.setPosition(this.sprite.x,this.sprite.y+10),this.shadow.setDepth(this.sprite.y-.5)}updatePatrol(){if(!this.waypoints.length)return;const s=this.waypoints[this.waypointIndex],t=s.x-this.sprite.x,e=s.y-this.sprite.y;Math.sqrt(t*t+e*e)<b?this.waypointIndex=(this.waypointIndex+1)%this.waypoints.length:this.moveToward(s.x,s.y,T)}updateSearch(s){const t=this.lastSeenPos.x-this.sprite.x,e=this.lastSeenPos.y-this.sprite.y;Math.sqrt(t*t+e*e)>b?this.moveToward(this.lastSeenPos.x,this.lastSeenPos.y,T):(this.sprite.setVelocity(0,0),this.searchTimer-=s,this.searchTimer<=0&&(this.state="PATROL"))}canSeePlayer(s,t){const e=s-this.sprite.x,i=t-this.sprite.y;if(e*e+i*i>R*R)return!1;const r=Math.atan2(i,e),a=Math.atan2(Math.sin(r-this.facingAngle),Math.cos(r-this.facingAngle));return Math.abs(a)>u.Math.DegToRad(k)?!1:!this.isRayBlocked(this.sprite.x,this.sprite.y,s,t)}isRayBlocked(s,t,e,i){const l=new u.Geom.Line(s,t,e,i);for(const r of this.obstacles){const a=new u.Geom.Rectangle(r.x,r.y,r.w,r.h),c=[];if(u.Geom.Intersects.GetLineToRectangle(l,a,c),c.length>0)return!0}return!1}moveToward(s,t,e){const i=s-this.sprite.x,l=t-this.sprite.y,r=Math.sqrt(i*i+l*l);if(r<1){this.sprite.setVelocity(0,0);return}this.sprite.setVelocity(i/r*e,l/r*e),this.facingAngle=Math.atan2(l,i)}drawVisionCone(){this.visionGraphics.clear();const s=this.state==="STUNNED"?16737792:16776960;this.visionGraphics.fillStyle(s,.22);const t=u.Math.DegToRad(k),e=14,i=[{x:this.sprite.x,y:this.sprite.y}];for(let l=0;l<=e;l++){const r=this.facingAngle-t+2*t*l/e;i.push({x:this.sprite.x+Math.cos(r)*R,y:this.sprite.y+Math.sin(r)*R})}this.visionGraphics.fillPoints(i,!0),this.visionGraphics.setDepth(this.sprite.y-1)}}class q{constructor(s,t,e,i,l){y(this,"treatsText");y(this,"poopsText");y(this,"helpText");y(this,"levelText");y(this,"muteBtn");y(this,"totalTreats");this.totalTreats=i;const r={fontSize:"18px",color:"#ffffff",stroke:"#000000",strokeThickness:3};this.treatsText=s.add.text(20,20,`Treats: 0/${i}`,r).setScrollFactor(0).setDepth(1e3),this.poopsText=s.add.text(20,46,"Poops: 3",r).setScrollFactor(0).setDepth(1e3),this.helpText=s.add.text(20,s.scale.height-36,"Move: WASD/Arrows   Drop Poop: Space   Mute: M",{fontSize:"14px",color:"#dddddd",stroke:"#000000",strokeThickness:2}).setScrollFactor(0).setDepth(1e3),this.levelText=s.add.text(s.scale.width-20,20,`Level ${t}/${e}`,r).setOrigin(1,0).setScrollFactor(0).setDepth(1e3),this.muteBtn=s.add.text(s.scale.width-20,46,"[SFX ON]",{fontSize:"14px",color:"#88ff88",stroke:"#000000",strokeThickness:2}).setOrigin(1,0).setScrollFactor(0).setDepth(1e3).setInteractive({useHandCursor:!0}),this.muteBtn.on("pointerover",()=>this.muteBtn.setAlpha(.7)),this.muteBtn.on("pointerout",()=>this.muteBtn.setAlpha(1)),this.muteBtn.on("pointerdown",()=>this.applyMuteToggle(l())),s.input.keyboard.addKey(u.Input.Keyboard.KeyCodes.M).on("down",()=>this.applyMuteToggle(l()))}applyMuteToggle(s){this.muteBtn.setText(s?"[SFX OFF]":"[SFX ON]"),this.muteBtn.setStyle({color:s?"#ff8888":"#88ff88"})}update(s,t){this.treatsText.setText(`Treats: ${s}/${this.totalTreats}`),this.poopsText.setText(`Poops: ${t}`)}showWin(s){this.showOverlay(s,"YOU WIN!","#00ff88")}showLose(s){this.showOverlay(s,"BUSTED!","#ff4444")}showOverlay(s,t,e){const i=s.scale.width,l=s.scale.height;s.add.rectangle(i/2,l/2,440,220,0,.78).setScrollFactor(0).setDepth(2e3),s.add.text(i/2,l/2-44,t,{fontSize:"52px",color:e,stroke:"#000000",strokeThickness:5}).setOrigin(.5).setScrollFactor(0).setDepth(2001);const r=s.add.text(i/2,l/2+44,"[ Restart ]",{fontSize:"26px",color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5).setScrollFactor(0).setDepth(2001).setInteractive({useHandCursor:!0});r.on("pointerover",()=>r.setStyle({color:"#ffff00"})),r.on("pointerout",()=>r.setStyle({color:"#ffffff"})),r.on("pointerdown",()=>s.scene.restart())}}class V{constructor(s){y(this,"ctx");y(this,"masterGain");y(this,"bgGain");y(this,"bgSource",null);y(this,"pantGain");y(this,"movingTime",0);y(this,"pantTimer",0);y(this,"isMuted",!1);this.ctx=s,this.masterGain=s.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(s.destination),this.bgGain=s.createGain(),this.bgGain.gain.value=0,this.bgGain.connect(this.masterGain),this.pantGain=s.createGain(),this.pantGain.gain.value=0,this.pantGain.connect(this.masterGain)}setBgFreq(s){this.stopBg();try{const t=this.ctx.sampleRate,e=this.ctx.createBuffer(1,t*2,t),i=e.getChannelData(0);for(let r=0;r<i.length;r++)i[r]=Math.random()*2-1;this.bgSource=this.ctx.createBufferSource(),this.bgSource.buffer=e,this.bgSource.loop=!0;const l=this.ctx.createBiquadFilter();l.type="bandpass",l.frequency.value=s,l.Q.value=1.5,this.bgSource.connect(l),l.connect(this.bgGain),this.bgGain.gain.setTargetAtTime(.03,this.ctx.currentTime,.8),this.bgSource.start()}catch{}}stopBg(){var s;try{(s=this.bgSource)==null||s.stop()}catch{}this.bgSource=null;try{this.bgGain.gain.setTargetAtTime(0,this.ctx.currentTime,.1)}catch{}}playBark(s){try{const t=this.ctx.currentTime,l=(1-Math.min(s/500,1)*.85)*.28;if(l<.002)return;const r=this.ctx.createGain();r.gain.setValueAtTime(l,t),r.gain.exponentialRampToValueAtTime(.001,t+.22),r.connect(this.masterGain);const a=this.ctx.createOscillator();a.type="sawtooth",a.frequency.setValueAtTime(650,t),a.frequency.exponentialRampToValueAtTime(180,t+.15),a.connect(r),a.start(t),a.stop(t+.24);const c=Math.floor(this.ctx.sampleRate*.12),h=this.ctx.createBuffer(1,c,this.ctx.sampleRate),o=h.getChannelData(0);for(let m=0;m<c;m++)o[m]=Math.random()*2-1;const n=this.ctx.createBufferSource();n.buffer=h;const f=this.ctx.createBiquadFilter();f.type="bandpass",f.frequency.value=750,f.Q.value=1.2;const d=this.ctx.createGain();d.gain.setValueAtTime(l*.45,t),d.gain.exponentialRampToValueAtTime(.001,t+.14),n.connect(f),f.connect(d),d.connect(this.masterGain),n.start(t)}catch{}}updatePant(s,t){try{if(s){this.movingTime=Math.min(this.movingTime+t,3e3);const e=this.movingTime/3e3,i=.028+e*.028;if(this.pantGain.gain.setTargetAtTime(i,this.ctx.currentTime,.3),this.pantTimer-=t,this.pantTimer<=0){this.firePantBurst();const l=350-e*60;this.pantTimer=l+Math.random()*120}}else this.movingTime=Math.max(this.movingTime-t*2,0),this.pantGain.gain.setTargetAtTime(0,this.ctx.currentTime,.15),this.pantTimer=0}catch{}}firePantBurst(){try{const s=this.ctx.currentTime,t=Math.floor(this.ctx.sampleRate*.07),e=this.ctx.createBuffer(1,t,this.ctx.sampleRate),i=e.getChannelData(0);for(let a=0;a<i.length;a++)i[a]=Math.random()*2-1;const l=this.ctx.createBufferSource();l.buffer=e;const r=this.ctx.createBiquadFilter();r.type="bandpass",r.frequency.value=440,r.Q.value=.9,l.connect(r),r.connect(this.pantGain),l.start(s)}catch{}}toggleMute(){this.isMuted=!this.isMuted;try{this.masterGain.gain.setTargetAtTime(this.isMuted?0:1,this.ctx.currentTime,.05)}catch{}return this.isMuted}getMuted(){return this.isMuted}stop(){this.stopBg();try{this.pantGain.gain.setTargetAtTime(0,this.ctx.currentTime,.05)}catch{}}}class U extends u.Scene{constructor(){super({key:"GameScene"});y(this,"player");y(this,"enemy");y(this,"ui");y(this,"wallGroup");y(this,"furnitureGroup");y(this,"treatGroup");y(this,"isGameOver",!1);y(this,"levelNum",1);y(this,"cfg");y(this,"audioManager");y(this,"barkTimer",0)}init(t){this.levelNum=(t==null?void 0:t.level)??1}create(){var i;this.isGameOver=!1,this.cfg=w[this.levelNum-1],this.physics.world.setBounds(0,0,this.cfg.worldWidth,this.cfg.worldHeight),this.buildTilemap(),this.buildLevelTextures(),this.buildDecoratives(),this.wallGroup=this.physics.add.staticGroup(),this.furnitureGroup=this.physics.add.staticGroup(),this.treatGroup=this.physics.add.staticGroup(),this.buildWalls(),this.buildFurniture(),this.buildTreats(),this.player=new H(this,this.cfg.playerStart.x,this.cfg.playerStart.y),this.enemy=new I(this,this.cfg.enemyStart.x,this.cfg.enemyStart.y);const t=[...this.cfg.walls,...this.cfg.furniture.map(l=>l.rect)];this.enemy.setObstacles(t),this.enemy.setWaypoints(this.cfg.patrolWaypoints),this.wireCollisions(),this.cameras.main.startFollow(this.player.sprite,!0,.1,.1).setBounds(0,0,this.cfg.worldWidth,this.cfg.worldHeight);const e=this.sound.context;e&&(this.audioManager=new V(e),this.audioManager.setBgFreq(this.cfg.audioFrequency),((i=this.data)==null?void 0:i.get("muted"))===!0&&this.audioManager.toggleMute()),this.ui=new q(this,this.levelNum,w.length,this.cfg.totalTreats,()=>{var r;const l=((r=this.audioManager)==null?void 0:r.toggleMute())??!1;return this.data.set("muted",l),l}),this.barkTimer=2e3+Math.random()*2e3,this.events.once(u.Scenes.Events.SHUTDOWN,()=>{var l;return(l=this.audioManager)==null?void 0:l.stop()}),console.assert(this.treatGroup.getChildren().length===this.cfg.totalTreats,`Treat count mismatch: expected ${this.cfg.totalTreats}, got ${this.treatGroup.getChildren().length}`)}update(t,e){if(!this.isGameOver&&(this.player.update(),this.enemy.update(e,this.player.sprite.x,this.player.sprite.y),this.ui.update(this.player.getTreatCount(),this.player.getPoopCharges()),this.audioManager)){this.updateBark(e);const i=this.player.sprite.body.velocity;this.audioManager.updatePant(Math.hypot(i.x,i.y)>10,e)}}updateBark(t){if(this.barkTimer-=t,this.barkTimer>0)return;const e=this.enemy.getState(),i=this.enemy.sprite.x-this.player.sprite.x,l=this.enemy.sprite.y-this.player.sprite.y;this.audioManager.playBark(Math.sqrt(i*i+l*l));const r=e==="CHASE"?900+Math.random()*700:e==="PATROL"?3500+Math.random()*2e3:e==="SEARCH"?4e3+Math.random()*2e3:7e3+Math.random()*3e3;this.barkTimer=r}buildTilemap(){var h;const t=`ground-tileset-L${this.levelNum}`;this.ensureTexture(t,128,32,o=>this.drawTilesetForLevel(o));const e=32,i=Math.ceil(this.cfg.worldWidth/e),l=Math.ceil(this.cfg.worldHeight/e),r=[];for(let o=0;o<l;o++){const n=[];for(let f=0;f<i;f++)n.push(this.cfg.tilePainter(o,f));r.push(n)}const a=this.make.tilemap({data:r,tileWidth:e,tileHeight:e}),c=a.addTilesetImage("tiles",t,e,e,0,0,1);c&&((h=a.createLayer(0,c,0,0))==null||h.setDepth(0))}drawTilesetForLevel(t){switch(this.levelNum){case 1:this.drawTilesetHouse(t);break;case 2:this.drawTilesetWaterPark(t);break;case 3:this.drawTilesetPark(t);break;case 4:this.drawTilesetCity(t);break;default:this.drawTilesetHouse(t);break}}drawTilesetHouse(t){t.fillStyle(4025127),t.fillRect(0,0,32,32),t.fillStyle(3498016),t.fillRect(0,0,16,16),t.fillRect(16,16,16,16),t.fillStyle(4683056),t.fillRect(16,0,16,16),t.fillRect(0,16,16,16),t.fillStyle(5934136);for(let e=0;e<4;e++)for(let i=0;i<4;i++)t.fillRect(i*8+e%2*3,e*8+1,2,4),t.fillRect(i*8+5-e%2*2,e*8+3,1,3);t.fillStyle(16777088),t.fillRect(5,10,2,2),t.fillStyle(16777215),t.fillRect(22,24,2,2),t.fillStyle(13936752),t.fillRect(32,0,32,32),t.fillStyle(11569240);for(let e=0;e<4;e++)t.fillRect(32,e*8,32,1);t.fillStyle(14727290),t.fillRect(32,2,14,1),t.fillRect(48,10,12,1),t.fillRect(36,18,16,1),t.fillRect(32,26,10,1),t.fillStyle(11569240),t.fillRect(48,0,1,8),t.fillRect(40,8,1,8),t.fillRect(52,16,1,8),t.fillRect(44,24,1,8),t.fillStyle(15261904),t.fillRect(64,0,32,32),t.fillStyle(11840672);for(let e=0;e<=4;e++)t.fillRect(64,e*8,32,1);for(let e=0;e<=4;e++)t.fillRect(64+e*8,0,1,32);t.fillStyle(14538181),t.fillRect(65,1,7,7),t.fillRect(81,1,7,7),t.fillRect(73,9,7,7),t.fillRect(89,9,7,7),t.fillRect(65,17,7,7),t.fillRect(81,17,7,7),t.fillRect(73,25,7,7),t.fillRect(89,25,7,7),t.fillStyle(12096874),t.fillRect(96,0,32,32),t.fillStyle(9464392),t.fillRect(96,0,32,2),t.fillRect(96,30,32,2),t.fillRect(96,0,2,32),t.fillRect(126,0,2,32),t.fillStyle(13279096),t.fillRect(98,8,28,16)}drawTilesetWaterPark(t){t.fillStyle(14208440),t.fillRect(0,0,32,32),t.fillStyle(13155498);for(let e=0;e<=4;e++)t.fillRect(0,e*8,32,1);for(let e=0;e<=4;e++)t.fillRect(e*8,0,1,32);t.fillStyle(14208440),t.fillRect(32,0,32,32),t.fillStyle(13155498);for(let e=0;e<=4;e++)t.fillRect(32,e*8,32,1);t.fillStyle(15259800),t.fillRect(64,0,32,32),t.fillStyle(14207104);for(let e=0;e<3;e++)t.fillRect(64+e*11,4,8,6),t.fillRect(64+e*11+5,16,6,5);t.fillStyle(4025127),t.fillRect(96,0,32,32),t.fillStyle(5934136);for(let e=0;e<4;e++)for(let i=0;i<4;i++)t.fillRect(96+i*8+e%2*3,e*8+1,2,4)}drawTilesetPark(t){t.fillStyle(4025127),t.fillRect(0,0,32,32),t.fillStyle(3498016),t.fillRect(0,0,16,16),t.fillRect(16,16,16,16),t.fillStyle(5934136);for(let e=0;e<4;e++)for(let i=0;i<4;i++)t.fillRect(i*8+e%2*3,e*8+1,2,4);t.fillStyle(16777088),t.fillRect(5,10,2,2),t.fillStyle(13150320),t.fillRect(32,0,32,32),t.fillStyle(11571296),t.fillRect(32,8,32,1),t.fillRect(32,20,32,1),t.fillStyle(14203008),t.fillRect(35,3,8,2),t.fillRect(50,13,6,2),t.fillRect(38,24,10,2),t.fillStyle(3811352),t.fillRect(64,0,32,32),t.fillStyle(16736352),t.fillCircle(68,4,2),t.fillCircle(76,8,2),t.fillStyle(16777024),t.fillCircle(72,14,2),t.fillCircle(84,6,2),t.fillStyle(16744703),t.fillCircle(80,18,2),t.fillCircle(68,20,2),t.fillStyle(4246592),t.fillRect(66,2,1,4),t.fillRect(70,6,1,4),t.fillStyle(9474192),t.fillRect(96,0,32,32),t.fillStyle(8421504),t.fillRect(96,10,32,2),t.fillRect(96,22,32,2),t.fillRect(104,0,2,32),t.fillRect(118,0,2,32),t.fillStyle(11053224),t.fillRect(97,1,6,8),t.fillRect(105,1,12,8),t.fillRect(97,13,10,8),t.fillRect(109,13,8,8)}drawTilesetCity(t){t.fillStyle(4210760),t.fillRect(0,0,32,32),t.fillStyle(3684416),t.fillRect(0,15,32,2),t.fillStyle(4737104),t.fillRect(4,0,1,32),t.fillRect(20,0,1,32),t.fillStyle(11579576),t.fillRect(32,0,32,32),t.fillStyle(10526888);for(let e=0;e<=4;e++)t.fillRect(32,e*8,32,1);for(let e=0;e<=4;e++)t.fillRect(32+e*8,0,1,32);t.fillStyle(12632264),t.fillRect(33,1,7,7),t.fillRect(49,9,7,7),t.fillRect(33,17,7,7),t.fillRect(49,25,7,7),t.fillStyle(13154456),t.fillRect(64,0,32,32),t.fillStyle(12101768),t.fillRect(64,0,32,2),t.fillRect(64,30,32,2),t.fillStyle(4210760),t.fillRect(96,0,32,32),t.fillStyle(16763904),t.fillRect(110,0,4,12),t.fillRect(110,18,4,14)}buildWalls(){this.ensureTexture("wall",8,8,t=>{t.fillStyle(4872312),t.fillRect(0,0,8,8),t.fillStyle(6846624),t.fillRect(0,3,8,2),t.fillStyle(4083310),t.fillRect(0,0,3,3),t.fillStyle(4872828),t.fillRect(4,0,4,3),t.fillStyle(3820138),t.fillRect(1,5,5,3),t.fillStyle(5795984),t.fillRect(0,7,8,1)});for(const t of this.cfg.walls)this.addStaticRect(this.wallGroup,t,"wall");this.wallGroup.refresh()}buildFurniture(){for(const t of this.cfg.furniture)this.addStaticRect(this.furnitureGroup,t.rect,t.textureKey);this.furnitureGroup.refresh()}buildLevelTextures(){switch(this.levelNum){case 1:this.buildTexturesHouse();break;case 2:this.buildTexturesWaterPark();break;case 3:this.buildTexturesPark();break;case 4:this.buildTexturesCity();break}this.ensureTexture("sparkle",8,8,t=>{t.fillStyle(11197951),t.fillCircle(4,4,4)}),this.ensureTexture("treat",10,10,t=>{t.fillStyle(30719),t.fillRect(0,0,10,10),t.fillStyle(2267647),t.fillRect(1,1,8,8),t.fillStyle(8965375),t.fillRect(1,1,3,2),t.fillStyle(17612),t.fillRect(0,8,10,2),t.fillRect(8,0,2,8)})}buildTexturesHouse(){this.ensureTexture("furniture-couch",36,14,t=>{t.fillStyle(4872328),t.fillRect(0,0,36,8),t.fillStyle(5597344),t.fillRect(1,1,10,6),t.fillRect(13,1,10,6),t.fillRect(25,1,10,6),t.fillStyle(6320304),t.fillRect(0,8,36,4),t.fillStyle(3819640),t.fillRect(12,8,1,4),t.fillRect(24,8,1,4),t.fillStyle(3819640),t.fillRect(0,0,3,14),t.fillRect(33,0,3,14),t.fillStyle(2760736),t.fillRect(3,12,3,2),t.fillRect(30,12,3,2)}),this.ensureTexture("furniture-table",24,16,t=>{t.fillStyle(12884560),t.fillRect(0,0,24,16),t.fillStyle(11371576),t.fillRect(0,2,24,1),t.fillRect(0,6,24,1),t.fillRect(0,10,24,1),t.fillRect(0,14,24,1),t.fillStyle(14198876),t.fillRect(2,3,10,1),t.fillRect(14,7,8,1),t.fillStyle(8018984),t.fillRect(1,1,3,3),t.fillRect(20,1,3,3),t.fillRect(1,12,3,3),t.fillRect(20,12,3,3),t.fillStyle(15260872),t.fillCircle(12,8,3),t.fillStyle(13922378),t.fillCircle(12,8,2)}),this.ensureTexture("furniture-bookshelf",14,24,t=>{t.fillStyle(3811864),t.fillRect(0,0,14,24),t.fillStyle(5914664),t.fillRect(1,5,12,1),t.fillRect(1,11,12,1),t.fillRect(1,17,12,1),t.fillStyle(13381680),t.fillRect(1,1,2,4),t.fillStyle(3170508),t.fillRect(3,1,2,4),t.fillStyle(3180616),t.fillRect(5,1,3,4),t.fillStyle(13936672),t.fillRect(8,1,2,4),t.fillStyle(8930440),t.fillRect(10,1,3,4),t.fillStyle(13656096),t.fillRect(1,7,3,4),t.fillStyle(4229192),t.fillRect(4,7,2,4),t.fillStyle(13381680),t.fillRect(6,7,2,4),t.fillStyle(3164296),t.fillRect(8,7,3,4),t.fillStyle(13152320),t.fillRect(11,7,2,4),t.fillStyle(3170508),t.fillRect(1,13,2,4),t.fillStyle(8930440),t.fillRect(3,13,3,4),t.fillStyle(13936672),t.fillRect(6,13,2,4),t.fillStyle(13381680),t.fillRect(8,13,2,4),t.fillStyle(3180616),t.fillRect(10,13,3,4),t.fillStyle(13656096),t.fillRect(1,19,2,4),t.fillStyle(3164296),t.fillRect(3,19,3,4),t.fillStyle(4229192),t.fillRect(6,19,2,4),t.fillStyle(13381680),t.fillRect(8,19,3,4)}),this.ensureTexture("furniture-kitchen-table",28,20,t=>{t.fillStyle(14729344),t.fillRect(0,0,28,20),t.fillStyle(13150304),t.fillRect(0,3,28,1),t.fillRect(0,7,28,1),t.fillRect(0,12,28,1),t.fillRect(0,16,28,1),t.fillStyle(15519888),t.fillRect(3,4,12,1),t.fillRect(16,8,10,1),t.fillStyle(10121264),t.fillRect(1,1,3,3),t.fillRect(24,1,3,3),t.fillRect(1,16,3,3),t.fillRect(24,16,3,3),t.fillStyle(13377568),t.fillCircle(14,10,3),t.fillStyle(2132016),t.fillRect(14,7,1,2)}),this.ensureTexture("bush",8,8,t=>{t.fillStyle(1989662),t.fillRect(0,0,8,8),t.fillStyle(3178544),t.fillCircle(2.5,3,2.5),t.fillCircle(5.5,2,2),t.fillCircle(4,6,2.5),t.fillCircle(7,5.5,1.5),t.fillStyle(5283920),t.fillCircle(2,2,1),t.fillCircle(6,1,1),t.fillStyle(1591320),t.fillRect(0,7,8,1),t.fillRect(7,0,1,8)}),this.ensureTexture("bush-shed",24,24,t=>{t.fillStyle(12101768),t.fillRect(0,0,24,24),t.fillStyle(6318200),t.fillRect(0,0,24,8),t.fillStyle(5265512);for(let e=0;e<24;e+=3)t.fillRect(e,0,1,8);t.fillStyle(8423576),t.fillRect(0,7,24,1),t.fillStyle(10127464),t.fillRect(0,8,24,1),t.fillRect(0,23,24,1),t.fillRect(0,8,1,16),t.fillRect(23,8,1,16),t.fillStyle(8017968),t.fillRect(9,14,6,9),t.fillStyle(5914656),t.fillRect(8,13,8,1),t.fillRect(8,23,8,1),t.fillRect(8,13,1,10),t.fillRect(15,13,1,10),t.fillStyle(13936672),t.fillRect(14,18,1,2),t.fillStyle(9091288),t.fillRect(2,11,4,4),t.fillRect(18,11,4,4),t.fillStyle(10127464),t.fillRect(2,11,4,1),t.fillRect(2,14,4,1),t.fillRect(2,11,1,4),t.fillRect(5,11,1,4),t.fillRect(18,11,4,1),t.fillRect(18,14,4,1),t.fillRect(18,11,1,4),t.fillRect(21,11,1,4),t.fillStyle(12101768),t.fillRect(3,12,2,1),t.fillRect(4,11,1,3),t.fillRect(19,12,2,1),t.fillRect(20,11,1,3)})}buildTexturesWaterPark(){this.ensureTexture("wpark-pool",32,32,t=>{t.fillStyle(35020),t.fillRect(0,0,32,32),t.fillStyle(43758);for(let e=4;e<32;e+=7)for(let i=0;i<32;i+=8)t.fillRect(i,e,5,2);t.fillStyle(6737151),t.fillRect(4,6,8,2),t.fillRect(18,12,6,2),t.fillRect(8,20,10,2)}),this.ensureTexture("wpark-wading",32,32,t=>{t.fillStyle(52394),t.fillRect(0,0,32,32),t.fillStyle(61115);for(let e=4;e<32;e+=8)t.fillRect(2,e,28,2);t.fillStyle(11206638),t.fillRect(6,8,6,3)}),this.ensureTexture("wpark-slide",32,32,t=>{t.fillStyle(14712864),t.fillRect(0,0,32,32),t.fillStyle(16752704),t.fillRect(2,2,28,6),t.fillStyle(16777056),t.fillRect(4,3,10,4),t.fillStyle(8405008),t.fillRect(10,8,4,24),t.fillStyle(13393936);for(let e=12;e<32;e+=6)t.fillRect(0,e,32,3)}),this.ensureTexture("wpark-snack",32,32,t=>{t.fillStyle(15786176),t.fillRect(0,0,32,32),t.fillStyle(14491680);for(let e=0;e<32;e+=6)t.fillRect(e,0,3,10);t.fillStyle(16777215),t.fillRect(0,10,32,1),t.fillStyle(10518624),t.fillRect(2,11,28,20),t.fillStyle(6307872),t.fillRect(12,16,8,15)}),this.ensureTexture("wpark-cabin",32,32,t=>{t.fillStyle(9071178),t.fillRect(0,0,32,32),t.fillStyle(6965802),t.fillRect(0,0,32,1),t.fillRect(0,0,1,32),t.fillRect(31,0,1,32),t.fillRect(0,31,32,1),t.fillStyle(5586992);for(let e=4;e<32;e+=6)t.fillRect(0,e,32,1);t.fillStyle(9091288),t.fillRect(4,8,8,6),t.fillRect(20,8,8,6),t.fillStyle(11165744),t.fillRect(12,18,8,14)}),this.ensureTexture("wpark-lounge",16,8,t=>{t.fillStyle(15645508),t.fillRect(0,0,16,8),t.fillStyle(13408546),t.fillRect(0,0,16,2),t.fillRect(0,0,2,8),t.fillRect(14,0,2,8),t.fillStyle(16768358),t.fillRect(2,3,12,2)})}buildTexturesPark(){this.ensureTexture("park-fountain",32,32,t=>{t.fillStyle(8952234),t.fillRect(0,0,32,32),t.fillStyle(30668),t.fillCircle(16,16,13),t.fillStyle(5614335),t.fillCircle(16,16,8),t.fillStyle(11197951),t.fillCircle(16,8,3),t.fillCircle(16,8,2),t.fillStyle(16777215),t.fillRect(15,5,2,6),t.fillRect(10,8,2,4),t.fillRect(20,8,2,4)}),this.ensureTexture("park-pond",32,32,t=>{t.fillStyle(21896),t.fillRect(0,0,32,32),t.fillStyle(30634),t.fillRect(2,2,28,28),t.fillStyle(39372);for(let e=6;e<28;e+=7)for(let i=4;i<28;i+=9)t.fillRect(i,e,6,2);t.fillStyle(5618653),t.fillRect(8,10,6,3)}),this.ensureTexture("park-tree",44,44,t=>{t.fillStyle(8015920),t.fillRect(19,28,6,12),t.fillStyle(1858588),t.fillCircle(22,18,16),t.fillStyle(2783280),t.fillCircle(22,16,13),t.fillStyle(3707434),t.fillCircle(14,14,7),t.fillCircle(28,13,8),t.fillCircle(20,8,6),t.fillCircle(26,20,6),t.fillStyle(5814336),t.fillCircle(16,10,4),t.fillCircle(24,9,4)}),this.ensureTexture("park-bench",32,12,t=>{t.fillStyle(8015920),t.fillRect(0,0,32,12),t.fillStyle(10119744);for(let e=0;e<32;e+=8)t.fillRect(e+1,1,6,6);t.fillStyle(5912608),t.fillRect(2,7,4,4),t.fillRect(26,7,4,4)}),this.ensureTexture("park-swings",32,32,t=>{t.fillStyle(8947848),t.fillRect(0,0,32,32),t.fillStyle(6316128),t.fillRect(0,0,32,3),t.fillRect(0,0,3,20),t.fillRect(29,0,3,20),t.fillStyle(4210752),t.fillRect(6,3,2,16),t.fillRect(14,3,2,16),t.fillRect(22,3,2,16),t.fillStyle(13408580),t.fillRect(4,19,6,4),t.fillRect(12,19,6,4),t.fillRect(20,19,6,4)}),this.ensureTexture("park-sandbox",32,32,t=>{t.fillStyle(10518592),t.fillRect(0,0,32,32),t.fillStyle(15259776),t.fillRect(3,3,26,26),t.fillStyle(15788184),t.fillRect(5,5,8,6),t.fillRect(18,12,6,6),t.fillRect(8,18,10,5),t.fillStyle(13408560),t.fillCircle(20,7,3)})}buildTexturesCity(){this.ensureTexture("city-building",32,32,t=>{t.fillStyle(7895160),t.fillRect(0,0,32,32),t.fillStyle(6842472),t.fillRect(0,0,32,2),t.fillRect(0,30,32,2),t.fillRect(0,0,2,32),t.fillRect(30,0,2,32),t.fillStyle(9091288);for(let e=4;e<28;e+=8)for(let i=4;i<28;i+=8)t.fillRect(i,e,5,5);t.fillStyle(5267568);for(let e=4;e<28;e+=8)for(let i=4;i<28;i+=8)t.fillRect(i,e,5,1),t.fillRect(i,e,1,5)}),this.ensureTexture("city-car",16,24,t=>{t.fillStyle(13377568),t.fillRect(0,0,16,24),t.fillStyle(9091288),t.fillRect(2,3,12,6),t.fillRect(2,16,12,5),t.fillStyle(1710618),t.fillRect(0,2,3,5),t.fillRect(13,2,3,5),t.fillRect(0,17,3,5),t.fillRect(13,17,3,5),t.fillStyle(15615044),t.fillRect(2,9,12,7)})}buildTreats(){const i=[];for(let l=-160;l<=160;l+=16)for(let r=-160;r<=160;r+=16)i.push([r,l]);i.sort(([l,r],[a,c])=>l*l+r*r-a*a-c*c);for(const l of this.cfg.treatPositions){let r=this.cfg.playerStart.x+40,a=this.cfg.playerStart.y;for(const[o,n]of i)if(this.isWalkable(l.x+o,l.y+n)){r=l.x+o,a=l.y+n;break}const c=this.treatGroup.create(r,a,"treat");c.setDepth(9990),c.refreshBody();const h=this.add.particles(r,a,"sparkle",{lifespan:700,speed:{min:12,max:28},scale:{start:.55,end:0},alpha:{start:.8,end:0},quantity:1,frequency:900,blendMode:u.BlendModes.ADD});h.setDepth(9991),c.setData("emitter",h)}this.treatGroup.refresh()}buildDecoratives(){switch(this.levelNum){case 1:this.buildDecorativesHouse();break;case 2:this.buildDecorativesWaterPark();break;case 3:this.buildDecorativesPark();break;case 4:this.buildDecorativesCity();break}}buildDecorativesHouse(){const t=this.add.graphics();t.fillStyle(8000789),t.fillRoundedRect(32,86,264,158,10),t.fillStyle(10102053),t.fillRoundedRect(40,94,248,142,7),t.fillStyle(6950928),t.fillRect(40,94,248,4),t.fillRect(40,232,248,4),t.fillRect(40,94,4,142),t.fillRect(284,94,4,142),t.setDepth(.5);const e=this.add.graphics();e.fillStyle(3824170),e.fillRoundedRect(42,445,135,96,6),e.fillStyle(4878392),e.fillRoundedRect(50,452,119,82,4),e.setDepth(.5);const i=this.add.graphics();i.fillStyle(10129536),i.fillRect(492,424,80,154),i.fillStyle(8945776);for(let l=424;l<578;l+=26)i.fillRect(492,l,80,2);for(let l=492;l<572;l+=26)i.fillRect(l,424,2,154);i.setDepth(.5);for(let l=28;l<=405;l+=28)this.add.rectangle(492,l+12,5,22,12095568).setDepth(l+22);for(let l=588;l<=738;l+=28)this.add.rectangle(492,l+12,5,22,12095568).setDepth(l+22);this.add.rectangle(492,428,7,20,9461808).setDepth(438),this.add.rectangle(492,572,7,20,9461808).setDepth(582),this.ensureTexture("tree",48,48,l=>{l.fillStyle(8015920),l.fillRect(21,30,6,14),l.fillStyle(6963232),l.fillRect(22,30,1,14),l.fillRect(25,32,1,10),l.fillStyle(1858588),l.fillCircle(24,20,18),l.fillStyle(2783280),l.fillCircle(24,18,15),l.fillStyle(3707434),l.fillCircle(16,16,7),l.fillCircle(30,15,8),l.fillCircle(22,10,7),l.fillCircle(28,22,6),l.fillStyle(5814336),l.fillCircle(18,12,5),l.fillCircle(26,11,4)});for(const l of[{x:632,y:300},{x:882,y:345}])this.add.image(l.x,l.y,"tree").setDepth(l.y+18)}buildDecorativesWaterPark(){const t=this.add.graphics();t.lineStyle(2,16777215,.5);for(let i=160;i<480;i+=64)t.beginPath(),t.moveTo(i,200),t.lineTo(i,460),t.strokePath();t.setDepth(.6);const e=this.add.graphics();e.fillStyle(13154456,.7),e.fillRect(180,460,60,240),e.setDepth(.5),this.add.text(940,105,"SNACKS",{fontSize:"12px",color:"#ffffff",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(200)}buildDecorativesPark(){const t=this.add.graphics();t.fillStyle(13150320,.8),t.fillRect(100,460,440,32),t.fillRect(590,100,32,360),t.fillRect(660,452,200,32),t.setDepth(.5);const e=this.add.graphics();e.fillStyle(3811352),e.fillEllipse(700,700,80,50),e.fillEllipse(300,200,60,40),e.fillEllipse(1100,500,70,45),e.fillStyle(16736352);for(const l of[{x:680,y:695},{x:710,y:705},{x:695,y:685}])e.fillCircle(l.x,l.y,5);e.fillStyle(16777024);for(const l of[{x:290,y:196},{x:308,y:202}])e.fillCircle(l.x,l.y,4);e.setDepth(.6);const i=this.add.graphics();i.fillStyle(12101744,.6);for(const l of[{x:190,y:375},{x:190,y:515},{x:750,y:395},{x:750,y:575},{x:530,y:695}])i.fillRect(l.x,l.y,100,38);i.setDepth(.5)}buildDecorativesCity(){const t=this.add.graphics();t.fillStyle(16763904);for(const i of[400,790])for(let l=80;l<940;l+=32)t.fillRect(i-1,l,3,18);for(let i=80;i<1200;i+=32)t.fillRect(i,479,18,3);t.setDepth(.6);const e=this.add.graphics();e.lineStyle(3,8947848,.8);for(const i of this.cfg.furniture.filter(l=>l.textureKey==="city-building"))e.strokeRect(i.rect.x-2,i.rect.y-2,i.rect.w+4,i.rect.h+4);e.setDepth(.7);for(const i of[{x:375,y:120},{x:375,y:380},{x:375,y:640},{x:685,y:120},{x:685,y:380},{x:685,y:640},{x:895,y:380}])this.add.rectangle(i.x,i.y,4,24,4210752).setDepth(i.y+12),this.add.rectangle(i.x,i.y-12,12,4,4210752).setDepth(i.y),this.add.rectangle(i.x+6,i.y-12,6,6,16777130,.9).setDepth(i.y)}wireCollisions(){this.physics.add.collider(this.player.sprite,this.wallGroup),this.physics.add.collider(this.player.sprite,this.furnitureGroup),this.physics.add.collider(this.enemy.sprite,this.wallGroup),this.physics.add.collider(this.enemy.sprite,this.furnitureGroup),this.physics.add.overlap(this.player.sprite,this.treatGroup,(t,e)=>{var l;const i=e;(l=i.getData("emitter"))==null||l.destroy(),i.destroy(),this.player.collectTreat(),this.player.getTreatCount()>=this.cfg.totalTreats&&this.triggerWin()}),this.physics.add.overlap(this.enemy.sprite,this.player.poops,(t,e)=>{e.destroy(),this.enemy.stun()}),this.physics.add.overlap(this.player.sprite,this.enemy.sprite,()=>this.triggerLose())}triggerWin(){var t;this.isGameOver||(this.isGameOver=!0,this.player.sprite.setVelocity(0,0),(t=this.audioManager)==null||t.stop(),this.levelNum>=w.length?this.ui.showWin(this):this.time.delayedCall(400,()=>this.scene.start("TransitionScene",{completedLevel:this.levelNum})))}triggerLose(){var t;this.isGameOver||(this.isGameOver=!0,this.player.sprite.setVelocity(0,0),(t=this.audioManager)==null||t.stop(),this.ui.showLose(this))}addStaticRect(t,e,i){const l=e.x+e.w/2,r=e.y+e.h/2,a=t.create(l,r,i);a.setDisplaySize(e.w,e.h),a.refreshBody(),a.setDepth(e.y+e.h/2)}isWalkable(t,e){if(t<0||t>this.cfg.worldWidth||e<0||e>this.cfg.worldHeight)return!1;const i=14;for(const l of[...this.cfg.walls,...this.cfg.furniture.map(r=>r.rect)])if(t>=l.x-i&&t<=l.x+l.w+i&&e>=l.y-i&&e<=l.y+l.h+i)return!1;return!0}ensureTexture(t,e,i,l){if(this.textures.exists(t))return;const r=this.add.graphics();l(r),r.generateTexture(t,e,i),r.destroy()}}class z extends u.Scene{constructor(){super({key:"TransitionScene"});y(this,"completedLevel",1)}init(t){this.completedLevel=t.completedLevel}create(){const t=this.completedLevel+1,e=w[t-1],i=this.scale.width,l=this.scale.height;this.add.rectangle(i/2,l/2,i,l,657946),this.add.text(i/2,l/2-130,`Level ${this.completedLevel} Complete!`,{fontSize:"44px",color:"#00ff88",stroke:"#000000",strokeThickness:5}).setOrigin(.5),this.add.text(i/2,l/2-60,`Next: Level ${t} — ${e.name}`,{fontSize:"28px",color:"#ffffcc",stroke:"#000000",strokeThickness:3}).setOrigin(.5);let r=5;const a=this.add.text(i/2,l/2+20,`Starting in ${r}...`,{fontSize:"18px",color:"#aaaaaa"}).setOrigin(.5);this.time.addEvent({delay:1e3,repeat:4,callback:()=>{r--,a.setText(r>0?`Starting in ${r}...`:"Starting...")}});const c=this.add.text(i/2,l/2+100,`[ Play Level ${t} → ]`,{fontSize:"26px",color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5).setInteractive({useHandCursor:!0});c.on("pointerover",()=>c.setStyle({color:"#ffff00"})),c.on("pointerout",()=>c.setStyle({color:"#ffffff"})),c.on("pointerdown",()=>this.startNext()),this.time.delayedCall(5e3,()=>this.startNext())}startNext(){this.scene.start("GameScene",{level:this.completedLevel+1})}}const $={type:u.AUTO,width:800,height:600,backgroundColor:"#1a1a2e",parent:document.body,physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scene:[A,U,z]};new u.Game($);
