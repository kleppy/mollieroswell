var O=Object.defineProperty;var L=(R,c,t)=>c in R?O(R,c,{enumerable:!0,configurable:!0,writable:!0,value:t}):R[c]=t;var y=(R,c,t)=>L(R,typeof c!="symbol"?c+"":c,t);import{r as N,g as I}from"./phaser-Czz4FBZH.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var W=N();const u=I(W);class B extends u.Scene{constructor(){super({key:"TitleScene"})}create(){const c=this.scale.width,t=this.scale.height;this.add.rectangle(c/2,t/2,c,t,526360);const e=this.add.graphics();for(let a=0;a<120;a++){const p=Math.random()*c,f=Math.random()*t,w=Math.random()<.8?1:2;e.fillStyle(16777215,.2+Math.random()*.5),e.fillCircle(p,f,w)}const i=this.add.text(c/2,t/2-120,"Mollie vs. Roswell",{fontSize:"48px",color:"#ffdd44",stroke:"#000000",strokeThickness:6,fontStyle:"bold"}).setOrigin(.5).setAlpha(0).setY(t/2-90),s=this.add.text(c/2,t/2-52,"Treat Heist",{fontSize:"30px",color:"#ff8844",stroke:"#000000",strokeThickness:4,fontStyle:"italic"}).setOrigin(.5).setAlpha(0),l=this.add.text(c/2,t/2+8,`Help Mollie the dachshund steal every treat
before Roswell the watchdog catches her!`,{fontSize:"14px",color:"#cccccc",stroke:"#000000",strokeThickness:2,align:"center"}).setOrigin(.5).setAlpha(0),r=this.add.text(c/2,t/2+72,"WASD / Arrow Keys — Move     Space — Drop Poop     M — Mute",{fontSize:"13px",color:"#aaaacc",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setAlpha(0),o=this.add.text(c/2,t/2+120,"Click or press any key to start",{fontSize:"18px",color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:i,alpha:1,y:t/2-120,duration:700,ease:"Back.Out"}),this.tweens.add({targets:s,alpha:1,duration:500,delay:500}),this.tweens.add({targets:[l,r],alpha:1,duration:400,delay:900}),this.tweens.add({targets:o,alpha:1,duration:300,delay:1200,onComplete:()=>{this.tweens.add({targets:o,alpha:.25,duration:700,yoyo:!0,repeat:-1,ease:"Sine.InOut"})}}),this.tweens.add({targets:i,y:t/2-116,duration:1800,yoyo:!0,repeat:-1,ease:"Sine.InOut",delay:900});const h=()=>{this.input.off("pointerdown",h),this.scene.start("GameScene",{level:1})};this.input.once("pointerdown",h),this.input.keyboard.once("keydown",h)}}const T=200,F=48,m=250,D=35,H=1e4,q=2e3,_=3e3,V=3e3,v=20,z=3,U={name:"The House",worldWidth:1024,worldHeight:768,totalTreats:20,playerStart:{x:80,y:660},enemyStart:{x:200,y:300},audioFrequency:200,walls:[{x:0,y:0,w:1024,h:20},{x:0,y:748,w:1024,h:20},{x:0,y:0,w:20,h:768},{x:1004,y:0,w:20,h:768},{x:20,y:392,w:130,h:16},{x:374,y:20,w:16,h:80},{x:374,y:220,w:16,h:200},{x:490,y:20,w:16,h:400},{x:490,y:580,w:16,h:168}],furniture:[{rect:{x:30,y:50,w:180,h:70},textureKey:"furniture-couch"},{rect:{x:50,y:240,w:120,h:80},textureKey:"furniture-table"},{rect:{x:295,y:50,w:70,h:120},textureKey:"furniture-bookshelf"},{rect:{x:40,y:450,w:140,h:100},textureKey:"furniture-kitchen-table"},{rect:{x:550,y:60,w:80,h:80},textureKey:"bush"},{rect:{x:740,y:80,w:90,h:90},textureKey:"bush"},{rect:{x:750,y:480,w:90,h:70},textureKey:"bush"},{rect:{x:870,y:620,w:120,h:120},textureKey:"bush-shed"}],treatPositions:[{x:220,y:65},{x:330,y:80},{x:280,y:180},{x:200,y:310},{x:80,y:420},{x:220,y:510},{x:70,y:700},{x:660,y:90},{x:850,y:160},{x:950,y:690},{x:340,y:300},{x:390,y:500},{x:160,y:140},{x:130,y:680},{x:250,y:700},{x:610,y:250},{x:760,y:350},{x:900,y:400},{x:630,y:700},{x:820,y:700}],patrolWaypoints:[{x:200,y:300},{x:390,y:130},{x:390,y:600},{x:150,y:600},{x:150,y:490},{x:620,y:400},{x:800,y:200},{x:920,y:600},{x:620,y:680}],tilePainter:(R,c)=>{const t=c*32,e=R*32;return t>=506?1:t>=374?4:e>=408?3:2}},X={name:"Water Park",worldWidth:1280,worldHeight:960,totalTreats:25,playerStart:{x:700,y:800},enemyStart:{x:700,y:400},audioFrequency:600,walls:[{x:0,y:0,w:1280,h:20},{x:0,y:940,w:1280,h:20},{x:0,y:0,w:20,h:960},{x:1260,y:0,w:20,h:960}],furniture:[{rect:{x:100,y:200,w:380,h:260},textureKey:"wpark-pool"},{rect:{x:120,y:700,w:200,h:160},textureKey:"wpark-wading"},{rect:{x:580,y:160,w:120,h:120},textureKey:"wpark-slide"},{rect:{x:900,y:80,w:160,h:120},textureKey:"wpark-snack"},{rect:{x:1060,y:380,w:120,h:140},textureKey:"wpark-cabin"},{rect:{x:1060,y:600,w:120,h:140},textureKey:"wpark-cabin"},{rect:{x:120,y:120,w:60,h:20},textureKey:"wpark-lounge"},{rect:{x:220,y:120,w:60,h:20},textureKey:"wpark-lounge"},{rect:{x:320,y:120,w:60,h:20},textureKey:"wpark-lounge"},{rect:{x:420,y:120,w:60,h:20},textureKey:"wpark-lounge"},{rect:{x:120,y:480,w:60,h:20},textureKey:"wpark-lounge"},{rect:{x:220,y:480,w:60,h:20},textureKey:"wpark-lounge"},{rect:{x:320,y:480,w:60,h:20},textureKey:"wpark-lounge"},{rect:{x:520,y:240,w:20,h:60},textureKey:"wpark-lounge"},{rect:{x:520,y:340,w:20,h:60},textureKey:"wpark-lounge"}],treatPositions:[{x:55,y:100},{x:55,y:580},{x:55,y:850},{x:250,y:600},{x:380,y:600},{x:510,y:100},{x:510,y:350},{x:510,y:600},{x:700,y:100},{x:700,y:350},{x:700,y:600},{x:700,y:850},{x:840,y:250},{x:840,y:450},{x:840,y:650},{x:840,y:850},{x:1e3,y:260},{x:1e3,y:530},{x:1200,y:200},{x:1200,y:500},{x:1200,y:760},{x:350,y:850},{x:250,y:850},{x:550,y:850},{x:950,y:850}],patrolWaypoints:[{x:60,y:100},{x:60,y:580},{x:60,y:880},{x:350,y:880},{x:700,y:880},{x:1200,y:880},{x:1200,y:100},{x:700,y:100},{x:700,y:520},{x:350,y:100}],tilePainter:(R,c)=>1},Y={name:"City Park",worldWidth:1280,worldHeight:960,totalTreats:28,playerStart:{x:100,y:860},enemyStart:{x:640,y:480},audioFrequency:400,walls:[{x:0,y:0,w:1280,h:20},{x:0,y:940,w:1280,h:20},{x:0,y:0,w:20,h:960},{x:1260,y:0,w:20,h:960}],furniture:[{rect:{x:540,y:420,w:120,h:120},textureKey:"park-fountain"},{rect:{x:820,y:60,w:280,h:200},textureKey:"park-pond"},{rect:{x:80,y:80,w:44,h:44},textureKey:"park-tree"},{rect:{x:180,y:60,w:44,h:44},textureKey:"park-tree"},{rect:{x:130,y:160,w:44,h:44},textureKey:"park-tree"},{rect:{x:460,y:80,w:44,h:44},textureKey:"park-tree"},{rect:{x:560,y:60,w:44,h:44},textureKey:"park-tree"},{rect:{x:1080,y:300,w:44,h:44},textureKey:"park-tree"},{rect:{x:1160,y:260,w:44,h:44},textureKey:"park-tree"},{rect:{x:1120,y:380,w:44,h:44},textureKey:"park-tree"},{rect:{x:1e3,y:760,w:44,h:44},textureKey:"park-tree"},{rect:{x:1100,y:800,w:44,h:44},textureKey:"park-tree"},{rect:{x:200,y:380,w:80,h:28},textureKey:"park-bench"},{rect:{x:200,y:520,w:80,h:28},textureKey:"park-bench"},{rect:{x:760,y:400,w:80,h:28},textureKey:"park-bench"},{rect:{x:760,y:580,w:80,h:28},textureKey:"park-bench"},{rect:{x:540,y:700,w:80,h:28},textureKey:"park-bench"},{rect:{x:80,y:680,w:120,h:60},textureKey:"park-swings"},{rect:{x:240,y:720,w:120,h:80},textureKey:"park-sandbox"}],treatPositions:[{x:60,y:300},{x:60,y:500},{x:60,y:700},{x:300,y:100},{x:400,y:200},{x:400,y:400},{x:400,y:600},{x:400,y:800},{x:640,y:200},{x:640,y:320},{x:640,y:580},{x:640,y:720},{x:640,y:880},{x:750,y:200},{x:880,y:320},{x:1e3,y:200},{x:1e3,y:480},{x:1e3,y:650},{x:1200,y:400},{x:1200,y:600},{x:1200,y:800},{x:200,y:880},{x:400,y:880},{x:500,y:820},{x:700,y:880},{x:900,y:880},{x:1100,y:680},{x:1200,y:100}],patrolWaypoints:[{x:640,y:480},{x:350,y:300},{x:100,y:300},{x:100,y:600},{x:420,y:800},{x:640,y:880},{x:950,y:800},{x:1200,y:600},{x:1200,y:300},{x:750,y:100},{x:350,y:100}],tilePainter:(R,c)=>{const t=R*32;return t<60||t>900?4:1}},$={name:"City Streets",worldWidth:1280,worldHeight:960,totalTreats:30,playerStart:{x:400,y:480},enemyStart:{x:790,y:480},audioFrequency:100,walls:[{x:0,y:0,w:1280,h:20},{x:0,y:940,w:1280,h:20},{x:0,y:0,w:20,h:960},{x:1260,y:0,w:20,h:960}],furniture:[{rect:{x:80,y:120,w:240,h:260},textureKey:"city-building"},{rect:{x:480,y:120,w:200,h:220},textureKey:"city-building"},{rect:{x:900,y:120,w:240,h:260},textureKey:"city-building"},{rect:{x:80,y:580,w:240,h:260},textureKey:"city-building"},{rect:{x:480,y:580,w:200,h:260},textureKey:"city-building"},{rect:{x:900,y:580,w:240,h:260},textureKey:"city-building"},{rect:{x:325,y:140,w:50,h:90},textureKey:"city-car"},{rect:{x:325,y:260,w:50,h:90},textureKey:"city-car"},{rect:{x:325,y:600,w:50,h:90},textureKey:"city-car"},{rect:{x:325,y:720,w:50,h:90},textureKey:"city-car"},{rect:{x:840,y:140,w:50,h:90},textureKey:"city-car"},{rect:{x:840,y:260,w:50,h:90},textureKey:"city-car"}],treatPositions:[{x:400,y:60},{x:600,y:60},{x:790,y:60},{x:400,y:200},{x:400,y:320},{x:600,y:200},{x:600,y:350},{x:790,y:200},{x:790,y:350},{x:1100,y:60},{x:1100,y:200},{x:1100,y:400},{x:400,y:480},{x:600,y:480},{x:790,y:480},{x:1100,y:480},{x:60,y:480},{x:60,y:200},{x:60,y:700},{x:400,y:600},{x:400,y:750},{x:600,y:680},{x:790,y:680},{x:1100,y:600},{x:1100,y:760},{x:400,y:890},{x:600,y:890},{x:790,y:890},{x:1100,y:890},{x:60,y:890}],patrolWaypoints:[{x:400,y:60},{x:790,y:60},{x:1200,y:60},{x:1200,y:480},{x:1200,y:890},{x:790,y:890},{x:400,y:890},{x:60,y:890},{x:60,y:480},{x:60,y:60}],tilePainter:(R,c)=>{const t=c*32,e=R*32;return t<80||t>1180||e<80||e>880?2:1}},b=[U,X,Y,$];class j{constructor(c,t,e){y(this,"sprite");y(this,"poops");y(this,"scene");y(this,"cursors");y(this,"wasd");y(this,"spaceKey");y(this,"poopCharges",z);y(this,"treatCount",0);y(this,"facingRight",!0);y(this,"shadow");if(this.scene=c,!c.textures.exists("poop")){const s=c.add.graphics();s.fillStyle(5909002),s.fillEllipse(8,14,14,6),s.fillStyle(7025425),s.fillEllipse(8,10,11,7),s.fillStyle(8010776),s.fillEllipse(8,6.5,8,6),s.fillStyle(9062434),s.fillEllipse(8,3,5,5),s.fillStyle(13398084),s.fillEllipse(6.5,1.5,2.5,2),s.fillStyle(16777215),s.fillCircle(5,10,2),s.fillCircle(11,10,2),s.fillStyle(1118481),s.fillCircle(5,10,1),s.fillCircle(11,10,1),s.fillStyle(16777215),s.fillRect(5,9,1,1),s.fillRect(11,9,1,1),s.generateTexture("poop",16,16),s.destroy()}this.shadow=c.add.ellipse(t,e+6,20,7,0,.25),this.sprite=c.physics.add.sprite(t,e,"mollie"),this.sprite.setDisplaySize(54,42),this.sprite.body.setSize(20,12,!0),this.sprite.setDepth(e),this.sprite.setCollideWorldBounds(!0),this.poops=c.physics.add.staticGroup();const i=c.input.keyboard;this.cursors=i.createCursorKeys(),this.wasd={up:i.addKey(u.Input.Keyboard.KeyCodes.W),down:i.addKey(u.Input.Keyboard.KeyCodes.S),left:i.addKey(u.Input.Keyboard.KeyCodes.A),right:i.addKey(u.Input.Keyboard.KeyCodes.D)},this.spaceKey=i.addKey(u.Input.Keyboard.KeyCodes.SPACE)}update(){const c=this.cursors.left.isDown||this.wasd.left.isDown,t=this.cursors.right.isDown||this.wasd.right.isDown,e=this.cursors.up.isDown||this.wasd.up.isDown,i=this.cursors.down.isDown||this.wasd.down.isDown;let s=0,l=0;c&&(s-=T),t&&(s+=T),e&&(l-=T),i&&(l+=T),s!==0&&l!==0&&(s*=.707,l*=.707),this.sprite.setVelocity(s,l),s>0?this.facingRight=!0:s<0&&(this.facingRight=!1),this.sprite.setFlipX(!this.facingRight),this.sprite.setDepth(this.sprite.y),this.shadow.setPosition(this.sprite.x,this.sprite.y+6),this.shadow.setDepth(this.sprite.y-.5),u.Input.Keyboard.JustDown(this.spaceKey)&&this.poopCharges>0&&this.dropPoop()}dropPoop(){this.poopCharges--;const c=this.poops.create(this.sprite.x,this.sprite.y,"poop");c.setDisplaySize(19,19),c.setDepth(4),c.refreshBody(),this.scene.time.delayedCall(H,()=>{c.active&&c.destroy()})}collectTreat(){this.treatCount++}getPoopCharges(){return this.poopCharges}getTreatCount(){return this.treatCount}}const M=140;class P{constructor(c,t,e){y(this,"sprite");y(this,"shadow");y(this,"visionGraphics");y(this,"state","PATROL");y(this,"waypointIndex",0);y(this,"facingAngle",0);y(this,"lastSeenPos",new u.Math.Vector2(0,0));y(this,"losTimer",0);y(this,"searchTimer",0);y(this,"stunTimer",0);y(this,"obstacles",[]);y(this,"waypoints",[]);y(this,"patrolSpeed",110);y(this,"chaseSpeed",M);y(this,"lastX",0);y(this,"lastY",0);y(this,"stuckTimer",0);y(this,"blockedCooldown",0);this.shadow=c.add.ellipse(t,e+10,16,6,0,.22),this.sprite=c.physics.add.sprite(t,e,"roswell"),this.sprite.setDisplaySize(58,46),this.sprite.body.setSize(16,24,!0),this.sprite.setDepth(e),this.sprite.setCollideWorldBounds(!0),this.visionGraphics=c.add.graphics()}setObstacles(c){this.obstacles=c}setWaypoints(c){this.waypoints=c}stun(){this.state="STUNNED",this.stunTimer=q}getState(){return this.state}update(c,t,e){if(this.state==="STUNNED"){this.stunTimer-=c,this.stunTimer<=0&&(this.state="PATROL");const s=this.waypoints[this.waypointIndex]??{x:this.sprite.x,y:this.sprite.y};this.moveToward(s.x,s.y,F),this.updateAnimAndDepth(),this.drawVisionCone();return}switch(this.canSeePlayer(t,e)?(this.state="CHASE",this.lastSeenPos.set(t,e),this.losTimer=0):this.state==="CHASE"&&(this.losTimer+=c,this.losTimer>=V&&(this.state="SEARCH",this.searchTimer=_,this.losTimer=0)),this.state){case"PATROL":this.updatePatrol();break;case"CHASE":this.moveToward(t,e,this.chaseSpeed);break;case"SEARCH":this.updateSearch(c);break}this.updateStuck(c),this.updateAnimAndDepth(),this.drawVisionCone()}updateAnimAndDepth(){this.sprite.setFlipX(Math.cos(this.facingAngle)<0),this.sprite.setDepth(this.sprite.y),this.shadow.setPosition(this.sprite.x,this.sprite.y+10),this.shadow.setDepth(this.sprite.y-.5)}updateStuck(c){if(this.stuckTimer+=c,this.stuckTimer>=500&&(Math.hypot(this.sprite.x-this.lastX,this.sprite.y-this.lastY)<2&&this.unstick(),this.lastX=this.sprite.x,this.lastY=this.sprite.y,this.stuckTimer=0),this.blockedCooldown=Math.max(0,this.blockedCooldown-c),this.blockedCooldown===0){const t=this.sprite.body.blocked,e=this.sprite.body.velocity;(t.left||t.right||t.up||t.down)&&(Math.abs(e.x)>10||Math.abs(e.y)>10)&&(this.unstick(),this.blockedCooldown=350)}}unstick(){if(this.state==="PATROL"&&this.waypoints.length)this.waypointIndex=(this.waypointIndex+1)%this.waypoints.length;else{const c=this.facingAngle+(Math.random()-.5)*Math.PI,t=this.state==="CHASE"?this.chaseSpeed:this.patrolSpeed;this.sprite.setVelocity(Math.cos(c)*t,Math.sin(c)*t)}}updatePatrol(){if(!this.waypoints.length)return;const c=this.waypoints[this.waypointIndex],t=c.x-this.sprite.x,e=c.y-this.sprite.y;Math.sqrt(t*t+e*e)<v?this.waypointIndex=(this.waypointIndex+1)%this.waypoints.length:this.moveToward(c.x,c.y,this.patrolSpeed)}updateSearch(c){const t=this.lastSeenPos.x-this.sprite.x,e=this.lastSeenPos.y-this.sprite.y;Math.sqrt(t*t+e*e)>v?this.moveToward(this.lastSeenPos.x,this.lastSeenPos.y,this.patrolSpeed):(this.sprite.setVelocity(0,0),this.searchTimer-=c,this.searchTimer<=0&&(this.state="PATROL"))}canSeePlayer(c,t){const e=c-this.sprite.x,i=t-this.sprite.y;if(e*e+i*i>m*m)return!1;const l=Math.atan2(i,e),r=Math.atan2(Math.sin(l-this.facingAngle),Math.cos(l-this.facingAngle));return Math.abs(r)>u.Math.DegToRad(D)?!1:!this.isRayBlocked(this.sprite.x,this.sprite.y,c,t)}isRayBlocked(c,t,e,i){const s=new u.Geom.Line(c,t,e,i);for(const l of this.obstacles){const r=new u.Geom.Rectangle(l.x,l.y,l.w,l.h),o=[];if(u.Geom.Intersects.GetLineToRectangle(s,r,o),o.length>0)return!0}return!1}moveToward(c,t,e){const i=c-this.sprite.x,s=t-this.sprite.y,l=Math.sqrt(i*i+s*s);if(l<1){this.sprite.setVelocity(0,0);return}this.sprite.setVelocity(i/l*e,s/l*e),this.facingAngle=Math.atan2(s,i)}drawVisionCone(){this.visionGraphics.clear();const c=this.state==="STUNNED"?16737792:16776960;this.visionGraphics.fillStyle(c,.22);const t=u.Math.DegToRad(D),e=14,i=[{x:this.sprite.x,y:this.sprite.y}];for(let s=0;s<=e;s++){const l=this.facingAngle-t+2*t*s/e;i.push({x:this.sprite.x+Math.cos(l)*m,y:this.sprite.y+Math.sin(l)*m})}this.visionGraphics.fillPoints(i,!0),this.visionGraphics.setDepth(this.sprite.y-1)}}class Q{constructor(c,t,e){y(this,"sprite");y(this,"shadow");y(this,"alive",!0);y(this,"scene");y(this,"speed",Math.round(M*1.01));y(this,"facingRight",!0);y(this,"currentTarget",null);y(this,"obstacles",[]);y(this,"lastSafeX",0);y(this,"lastSafeY",0);y(this,"lastX",0);y(this,"lastY",0);y(this,"stuckTimer",0);y(this,"blockedCooldown",0);y(this,"detourPoint",null);y(this,"detourTimer",0);y(this,"detourDir",1);this.scene=c,this.shadow=c.add.ellipse(t,e+6,18,6,0,.2),this.sprite=c.physics.add.sprite(t,e,"axol"),this.sprite.setDisplaySize(48,38),this.sprite.body.setSize(20,14,!0),this.sprite.setDepth(e),this.sprite.setCollideWorldBounds(!0),this.lastSafeX=t,this.lastSafeY=e,this.smokeEffect(t,e)}setObstacles(c){this.obstacles=c}isAlive(){return this.alive}poof(){if(!this.alive)return;this.alive=!1,this.sprite.setVelocity(0,0),this.sprite.body.enable=!1;const c=this.sprite.x,t=this.sprite.y;this.sprite.destroy(),this.shadow.destroy(),this.smokeEffect(c,t)}update(c,t){if(this.alive){if(this.obstacles.length>0&&this.isEmbedded()?this.snapToSafePosition():(this.lastSafeX=this.sprite.x,this.lastSafeY=this.sprite.y),this.currentTarget&&!this.currentTarget.active&&(this.currentTarget=null,this.detourPoint=null,this.detourTimer=0),this.currentTarget||(this.currentTarget=this.findNearest(t),this.detourPoint=null,this.detourTimer=0),!this.currentTarget){this.sprite.setVelocity(0,0),this.updateVisuals();return}if(this.hasLOS(this.sprite.x,this.sprite.y,this.currentTarget.x,this.currentTarget.y))this.detourPoint=null,this.detourTimer=0,this.steerToward(this.currentTarget.x,this.currentTarget.y);else{const e=this.findNearestWithLOS(t);e?(this.detourPoint=null,this.detourTimer=0,this.steerToward(e.x,e.y)):this.updateDetour(c)}this.updateStuck(c),this.updateVisuals()}}steerToward(c,t,e=0){const i=c-this.sprite.x,s=t-this.sprite.y;if(Math.sqrt(i*i+s*s)<1){this.sprite.setVelocity(0,0);return}const r=Math.atan2(s,i)+e;this.sprite.setVelocity(Math.cos(r)*this.speed,Math.sin(r)*this.speed),this.facingRight=Math.cos(r)>=0}findNearest(c){const t=c.getChildren();let e=null,i=1/0;for(const s of t){if(!s.active)continue;const l=s.x-this.sprite.x,r=s.y-this.sprite.y,o=l*l+r*r;o<i&&(i=o,e=s)}return e}updateVisuals(){this.sprite.setFlipX(!this.facingRight),this.sprite.setDepth(this.sprite.y),this.shadow.setPosition(this.sprite.x,this.sprite.y+6),this.shadow.setDepth(this.sprite.y-.5)}updateStuck(c){if(this.stuckTimer+=c,this.stuckTimer>=450){if(Math.hypot(this.sprite.x-this.lastX,this.sprite.y-this.lastY)<2&&this.currentTarget){const e=(Math.random()-.5)*(Math.PI/3);this.steerToward(this.currentTarget.x,this.currentTarget.y,e)}this.lastX=this.sprite.x,this.lastY=this.sprite.y,this.stuckTimer=0}if(this.blockedCooldown=Math.max(0,this.blockedCooldown-c),this.blockedCooldown===0){const t=this.sprite.body.blocked,e=this.sprite.body.velocity;(t.left||t.right||t.up||t.down)&&(Math.abs(e.x)>10||Math.abs(e.y)>10)&&(this.nudgeAwayFromWall(),this.blockedCooldown=300)}}nudgeAwayFromWall(){const c=this.sprite.body.blocked,t=3;let e=this.sprite.x,i=this.sprite.y;if(c.left&&(e+=t),c.right&&(e-=t),c.up&&(i+=t),c.down&&(i-=t),this.sprite.body.reset(e,i),this.currentTarget){const s=(Math.random()-.5)*(Math.PI/3);this.steerToward(this.currentTarget.x,this.currentTarget.y,s)}}findNearestWithLOS(c){const t=c.getChildren();let e=null,i=1/0;for(const s of t){if(!s.active||!this.hasLOS(this.sprite.x,this.sprite.y,s.x,s.y))continue;const l=s.x-this.sprite.x,r=s.y-this.sprite.y,o=l*l+r*r;o<i&&(i=o,e=s)}return e}hasLOS(c,t,e,i){for(const l of this.obstacles)if(this.segmentIntersectsAABB(c,t,e,i,l.x-4,l.y-4,l.x+l.w+4,l.y+l.h+4))return!1;return!0}segmentIntersectsAABB(c,t,e,i,s,l,r,o){let h=0,a=1;const p=e-c,f=i-t,w=[[-p,c-s],[p,r-c],[-f,t-l],[f,o-t]];for(const[d,k]of w){if(d===0){if(k<0)return!1;continue}const S=k/d;if(d<0?h=Math.max(h,S):a=Math.min(a,S),h>a)return!1}return!0}updateDetour(c){this.detourTimer+=c;const t=this.detourPoint!==null&&Math.hypot(this.sprite.x-this.detourPoint.x,this.sprite.y-this.detourPoint.y)<24;(!this.detourPoint||t||this.detourTimer>700)&&(this.computeDetourPoint(),this.detourTimer=0),this.detourPoint&&this.steerToward(this.detourPoint.x,this.detourPoint.y)}computeDetourPoint(){if(!this.currentTarget){this.detourPoint=null;return}const c=this.currentTarget.x-this.sprite.x,t=this.currentTarget.y-this.sprite.y,e=Math.sqrt(c*c+t*t);if(e<1){this.detourPoint=null;return}const i=-t/e,s=c/e,l=110,r={x:this.sprite.x+i*l,y:this.sprite.y+s*l},o={x:this.sprite.x-i*l,y:this.sprite.y-s*l},h=this.isSafePosition(r.x,r.y),a=this.isSafePosition(o.x,o.y);this.detourDir===1&&h?this.detourPoint=r:a?(this.detourDir=-1,this.detourPoint=o):h?(this.detourDir=1,this.detourPoint=r):this.detourPoint={x:this.sprite.x+i*160,y:this.sprite.y+s*160}}isEmbedded(){const c=this.sprite.body.x,t=this.sprite.body.y,e=this.sprite.body.width,i=this.sprite.body.height;for(const s of this.obstacles)if(c<s.x+s.w&&c+e>s.x&&t<s.y+s.h&&t+i>s.y)return!0;return!1}isSafePosition(c,t){const e=this.sprite.body.halfWidth,i=this.sprite.body.halfHeight,s=c-e,l=t-i,r=e*2,o=i*2,h=this.scene.physics.world.bounds;if(s<h.x||s+r>h.x+h.width||l<h.y||l+o>h.y+h.height)return!1;for(const a of this.obstacles)if(s<a.x+a.w&&s+r>a.x&&l<a.y+a.h&&l+o>a.y)return!1;return!0}snapToSafePosition(){if(this.sprite.setVelocity(0,0),this.isSafePosition(this.lastSafeX,this.lastSafeY)){this.sprite.body.reset(this.lastSafeX,this.lastSafeY);return}const c=16,t=300,e=16;for(let i=c;i<=t;i+=c)for(let s=0;s<e;s++){const l=s/e*Math.PI*2,r=this.sprite.x+Math.cos(l)*i,o=this.sprite.y+Math.sin(l)*i;if(this.isSafePosition(r,o)){this.sprite.body.reset(r,o),this.lastSafeX=r,this.lastSafeY=o;return}}}smokeEffect(c,t){const e=this.scene.add.graphics();e.setDepth(9999);const i={progress:0};this.scene.tweens.add({targets:i,progress:1,duration:450,ease:"Sine.Out",onUpdate:()=>{const s=i.progress;e.clear(),e.fillStyle(14540287,.75*(1-s)),e.fillCircle(c,t,24*s),e.fillStyle(12303342,.5*(1-s)),e.fillCircle(c-12*s,t-8*s,16*s),e.fillCircle(c+14*s,t-5*s,14*s)},onComplete:()=>{e.destroy()}})}}class J{constructor(c,t,e,i,s){y(this,"treatsText");y(this,"poopsText");y(this,"helpText");y(this,"levelText");y(this,"muteBtn");y(this,"totalTreats");this.totalTreats=i;const l={fontSize:"18px",color:"#ffffff",stroke:"#000000",strokeThickness:3};this.treatsText=c.add.text(20,20,`Treats: 0/${i}`,l).setScrollFactor(0).setDepth(1e3),this.poopsText=c.add.text(20,46,"Poops: 3",l).setScrollFactor(0).setDepth(1e3),this.helpText=c.add.text(20,c.scale.height-36,"Move: WASD/Arrows   Drop Poop: Space   Mute: M",{fontSize:"14px",color:"#dddddd",stroke:"#000000",strokeThickness:2}).setScrollFactor(0).setDepth(1e3),this.levelText=c.add.text(c.scale.width-20,20,`Level ${t}/${e}`,l).setOrigin(1,0).setScrollFactor(0).setDepth(1e3),this.muteBtn=c.add.text(c.scale.width-20,46,"[SFX ON]",{fontSize:"14px",color:"#88ff88",stroke:"#000000",strokeThickness:2}).setOrigin(1,0).setScrollFactor(0).setDepth(1e3).setInteractive({useHandCursor:!0}),this.muteBtn.on("pointerover",()=>this.muteBtn.setAlpha(.7)),this.muteBtn.on("pointerout",()=>this.muteBtn.setAlpha(1)),this.muteBtn.on("pointerdown",()=>this.applyMuteToggle(s())),c.input.keyboard.addKey(u.Input.Keyboard.KeyCodes.M).on("down",()=>this.applyMuteToggle(s()))}applyMuteToggle(c){this.muteBtn.setText(c?"[SFX OFF]":"[SFX ON]"),this.muteBtn.setStyle({color:c?"#ff8888":"#88ff88"})}update(c,t){this.treatsText.setText(`Treats: ${c}/${this.totalTreats}`),this.poopsText.setText(`Poops: ${t}`)}showWin(c){this.showOverlay(c,"YOU WIN!","#00ff88")}showLose(c){this.showOverlay(c,"BUSTED!","#ff4444")}showOverlay(c,t,e){const i=c.scale.width,s=c.scale.height;c.add.rectangle(i/2,s/2,440,220,0,.78).setScrollFactor(0).setDepth(2e3),c.add.text(i/2,s/2-44,t,{fontSize:"52px",color:e,stroke:"#000000",strokeThickness:5}).setOrigin(.5).setScrollFactor(0).setDepth(2001);const l=c.add.text(i/2,s/2+44,"[ Restart ]",{fontSize:"26px",color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5).setScrollFactor(0).setDepth(2001).setInteractive({useHandCursor:!0});l.on("pointerover",()=>l.setStyle({color:"#ffff00"})),l.on("pointerout",()=>l.setStyle({color:"#ffffff"})),l.on("pointerdown",()=>c.scene.restart())}}class Z{constructor(c){y(this,"ctx");y(this,"masterGain");y(this,"bgGain");y(this,"bgSource",null);y(this,"pantGain");y(this,"movingTime",0);y(this,"pantTimer",0);y(this,"isMuted",!1);this.ctx=c,this.masterGain=c.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(c.destination),this.bgGain=c.createGain(),this.bgGain.gain.value=0,this.bgGain.connect(this.masterGain),this.pantGain=c.createGain(),this.pantGain.gain.value=0,this.pantGain.connect(this.masterGain)}setBgFreq(c){this.stopBg();try{const t=this.ctx.sampleRate,e=this.ctx.createBuffer(1,t*2,t),i=e.getChannelData(0);for(let l=0;l<i.length;l++)i[l]=Math.random()*2-1;this.bgSource=this.ctx.createBufferSource(),this.bgSource.buffer=e,this.bgSource.loop=!0;const s=this.ctx.createBiquadFilter();s.type="bandpass",s.frequency.value=c,s.Q.value=1.5,this.bgSource.connect(s),s.connect(this.bgGain),this.bgGain.gain.setTargetAtTime(.03,this.ctx.currentTime,.8),this.bgSource.start()}catch{}}stopBg(){var c;try{(c=this.bgSource)==null||c.stop()}catch{}this.bgSource=null;try{this.bgGain.gain.setTargetAtTime(0,this.ctx.currentTime,.1)}catch{}}playBark(c){try{const t=this.ctx.currentTime,s=(1-Math.min(c/500,1)*.85)*.28;if(s<.002)return;const l=this.ctx.createGain();l.gain.setValueAtTime(s,t),l.gain.exponentialRampToValueAtTime(.001,t+.22),l.connect(this.masterGain);const r=this.ctx.createOscillator();r.type="sawtooth",r.frequency.setValueAtTime(650,t),r.frequency.exponentialRampToValueAtTime(180,t+.15),r.connect(l),r.start(t),r.stop(t+.24);const o=Math.floor(this.ctx.sampleRate*.12),h=this.ctx.createBuffer(1,o,this.ctx.sampleRate),a=h.getChannelData(0);for(let d=0;d<o;d++)a[d]=Math.random()*2-1;const p=this.ctx.createBufferSource();p.buffer=h;const f=this.ctx.createBiquadFilter();f.type="bandpass",f.frequency.value=750,f.Q.value=1.2;const w=this.ctx.createGain();w.gain.setValueAtTime(s*.45,t),w.gain.exponentialRampToValueAtTime(.001,t+.14),p.connect(f),f.connect(w),w.connect(this.masterGain),p.start(t)}catch{}}updatePant(c,t){try{if(c){this.movingTime=Math.min(this.movingTime+t,3e3);const e=this.movingTime/3e3,i=.028+e*.028;if(this.pantGain.gain.setTargetAtTime(i,this.ctx.currentTime,.3),this.pantTimer-=t,this.pantTimer<=0){this.firePantBurst();const s=350-e*60;this.pantTimer=s+Math.random()*120}}else this.movingTime=Math.max(this.movingTime-t*2,0),this.pantGain.gain.setTargetAtTime(0,this.ctx.currentTime,.15),this.pantTimer=0}catch{}}firePantBurst(){try{const c=this.ctx.currentTime,t=Math.floor(this.ctx.sampleRate*.07),e=this.ctx.createBuffer(1,t,this.ctx.sampleRate),i=e.getChannelData(0);for(let r=0;r<i.length;r++)i[r]=Math.random()*2-1;const s=this.ctx.createBufferSource();s.buffer=e;const l=this.ctx.createBiquadFilter();l.type="bandpass",l.frequency.value=440,l.Q.value=.9,s.connect(l),l.connect(this.pantGain),s.start(c)}catch{}}toggleMute(){this.isMuted=!this.isMuted;try{this.masterGain.gain.setTargetAtTime(this.isMuted?0:1,this.ctx.currentTime,.05)}catch{}return this.isMuted}getMuted(){return this.isMuted}stop(){this.stopBg();try{this.pantGain.gain.setTargetAtTime(0,this.ctx.currentTime,.05)}catch{}}}class x extends u.Scene{constructor(){super({key:"GameScene"});y(this,"player");y(this,"enemy");y(this,"enemy2",null);y(this,"axol",null);y(this,"ui");y(this,"wallGroup");y(this,"furnitureGroup");y(this,"treatGroup");y(this,"pinkTreatGroup");y(this,"isGameOver",!1);y(this,"levelNum",1);y(this,"cfg");y(this,"audioManager");y(this,"barkTimer",0)}preload(){this.load.image("mollie","/assets/mollie.png"),this.load.image("roswell","/assets/roswell.png"),this.load.image("axol","/assets/axol.png"),this.load.audio("crunch",["/assets/sfx/crunch.mp3","/assets/sfx/crunch.ogg"])}init(t){this.levelNum=(t==null?void 0:t.level)??1}create(){var i;this.isGameOver=!1,this.axol=null,this.cfg=b[this.levelNum-1],this.physics.world.setBounds(0,0,this.cfg.worldWidth,this.cfg.worldHeight),this.buildTilemap(),this.buildLevelTextures(),this.buildDecoratives(),this.wallGroup=this.physics.add.staticGroup(),this.furnitureGroup=this.physics.add.staticGroup(),this.treatGroup=this.physics.add.staticGroup(),this.pinkTreatGroup=this.physics.add.staticGroup(),this.buildWalls(),this.buildFurniture(),this.buildTreats(),this.buildPinkTreat(),this.player=new j(this,this.cfg.playerStart.x,this.cfg.playerStart.y),this.enemy=new P(this,this.cfg.enemyStart.x,this.cfg.enemyStart.y),this.enemy2=null;const t=[...this.cfg.walls,...this.cfg.furniture.map(s=>s.rect)];this.enemy.setObstacles(t),this.enemy.setWaypoints(this.cfg.patrolWaypoints),this.levelNum===3&&(this.enemy2=new P(this,1150,500),this.enemy2.setObstacles(t),this.enemy2.setWaypoints(this.cfg.patrolWaypoints)),this.wireCollisions(),this.cameras.main.startFollow(this.player.sprite,!0,.1,.1).setBounds(0,0,this.cfg.worldWidth,this.cfg.worldHeight);const e=this.sound.context;e&&(this.audioManager=new Z(e),this.audioManager.setBgFreq(this.cfg.audioFrequency),((i=this.data)==null?void 0:i.get("muted"))===!0&&this.audioManager.toggleMute()),this.ui=new J(this,this.levelNum,b.length,this.cfg.totalTreats,()=>{var l;const s=((l=this.audioManager)==null?void 0:l.toggleMute())??!1;return this.data.set("muted",s),s}),this.barkTimer=2e3+Math.random()*2e3,this.events.once(u.Scenes.Events.SHUTDOWN,()=>{var s;return(s=this.audioManager)==null?void 0:s.stop()}),console.assert(this.treatGroup.getChildren().length===this.cfg.totalTreats,`Treat count mismatch: expected ${this.cfg.totalTreats}, got ${this.treatGroup.getChildren().length}`)}update(t,e){var h,a;if(this.isGameOver)return;this.player.update();const i=this.player.sprite.x,s=this.player.sprite.y,l=((h=this.axol)==null?void 0:h.isAlive())??!1,r=(p,f)=>{if(l){const w=this.axol.sprite.x-p,d=this.axol.sprite.y-f;if(Math.hypot(w,d)<m)return{x:this.axol.sprite.x,y:this.axol.sprite.y}}return{x:i,y:s}},o=r(this.enemy.sprite.x,this.enemy.sprite.y);if(this.enemy.update(e,o.x,o.y),this.enemy2){const p=r(this.enemy2.sprite.x,this.enemy2.sprite.y);this.enemy2.update(e,p.x,p.y)}if((a=this.axol)==null||a.update(e,this.treatGroup),this.ui.update(this.player.getTreatCount(),this.player.getPoopCharges()),this.audioManager){this.updateBark(e);const p=this.player.sprite.body.velocity;this.audioManager.updatePant(Math.hypot(p.x,p.y)>10,e)}}updateBark(t){if(this.barkTimer-=t,this.barkTimer>0)return;const e=this.enemy.sprite.x-this.player.sprite.x,i=this.enemy.sprite.y-this.player.sprite.y;let s=Math.sqrt(e*e+i*i),l=this.enemy.getState();if(this.enemy2){const o=this.enemy2.sprite.x-this.player.sprite.x,h=this.enemy2.sprite.y-this.player.sprite.y,a=Math.sqrt(o*o+h*h);a<s&&(s=a),this.enemy2.getState()==="CHASE"&&(l="CHASE")}this.audioManager.playBark(s);const r=l==="CHASE"?900+Math.random()*700:l==="PATROL"?3500+Math.random()*2e3:l==="SEARCH"?4e3+Math.random()*2e3:7e3+Math.random()*3e3;this.barkTimer=r}buildTilemap(){var h;const t=`ground-tileset-L${this.levelNum}`;this.ensureTexture(t,128,32,a=>this.drawTilesetForLevel(a));const e=32,i=Math.ceil(this.cfg.worldWidth/e),s=Math.ceil(this.cfg.worldHeight/e),l=[];for(let a=0;a<s;a++){const p=[];for(let f=0;f<i;f++)p.push(this.cfg.tilePainter(a,f));l.push(p)}const r=this.make.tilemap({data:l,tileWidth:e,tileHeight:e}),o=r.addTilesetImage("tiles",t,e,e,0,0,1);o&&((h=r.createLayer(0,o,0,0))==null||h.setDepth(0))}drawTilesetForLevel(t){switch(this.levelNum){case 1:this.drawTilesetHouse(t);break;case 2:this.drawTilesetWaterPark(t);break;case 3:this.drawTilesetPark(t);break;case 4:this.drawTilesetCity(t);break;default:this.drawTilesetHouse(t);break}}drawTilesetHouse(t){t.fillStyle(4025127),t.fillRect(0,0,32,32),t.fillStyle(3498016),t.fillRect(0,0,16,16),t.fillRect(16,16,16,16),t.fillStyle(4683056),t.fillRect(16,0,16,16),t.fillRect(0,16,16,16),t.fillStyle(5934136);for(let e=0;e<4;e++)for(let i=0;i<4;i++)t.fillRect(i*8+e%2*3,e*8+1,2,5),t.fillRect(i*8+5-e%2*2,e*8+3,1,4);t.fillStyle(7514176),t.fillRect(3,6,1,4),t.fillRect(19,14,1,5),t.fillRect(11,22,1,4),t.fillRect(26,7,1,5),t.fillRect(7,28,1,3),t.fillRect(23,2,1,4),t.fillStyle(2641176),t.fillRect(0,30,32,2),t.fillStyle(16777088),t.fillRect(5,10,2,2),t.fillStyle(16777215),t.fillRect(22,24,2,2),t.fillStyle(16751018),t.fillRect(14,18,2,2),t.fillStyle(16772693),t.fillRect(28,20,1,1),t.fillStyle(8969540),t.fillRect(9,29,1,1),t.fillRect(17,5,1,1),t.fillStyle(13148256),t.fillRect(32,0,32,32),t.fillStyle(9461824);for(let e=0;e<4;e++)t.fillRect(32,e*8,32,1);t.fillStyle(13938792),t.fillRect(32,1,18,7),t.fillStyle(12227664),t.fillRect(50,1,14,7),t.fillStyle(13674592),t.fillRect(32,9,22,7),t.fillStyle(12095568),t.fillRect(54,9,10,7),t.fillStyle(12882008),t.fillRect(32,17,13,7),t.fillStyle(14201966),t.fillRect(45,17,19,7),t.fillStyle(12492896),t.fillRect(32,25,19,7),t.fillStyle(13675112),t.fillRect(51,25,13,7),t.fillStyle(15255680),t.fillRect(34,3,12,1),t.fillRect(51,5,10,1),t.fillRect(36,11,17,1),t.fillRect(55,13,8,1),t.fillRect(33,19,9,1),t.fillRect(47,21,13,1),t.fillRect(36,27,14,1),t.fillRect(53,29,9,1),t.fillStyle(8937520),t.fillRect(49,1,1,7),t.fillRect(41,9,1,7),t.fillRect(57,17,1,7),t.fillRect(44,25,1,7),t.fillStyle(8015920),t.fillRect(39,3,3,2),t.fillRect(58,18,3,2),t.fillRect(43,27,2,2),t.fillStyle(10119240),t.fillRect(40,4,1,1),t.fillRect(59,19,1,1),t.fillStyle(14735560),t.fillRect(64,0,32,32),t.fillStyle(11051162);for(let e=0;e<=4;e++)t.fillRect(64,e*8,32,1);for(let e=0;e<=4;e++)t.fillRect(64+e*8,0,1,32);t.fillStyle(14538181);for(let e=0;e<4;e++)for(let i=0;i<4;i++)t.fillRect(64+i*8+1,e*8+1,7,7);t.fillStyle(15788248);for(let e=0;e<4;e++)for(let i=0;i<4;i++)t.fillRect(64+i*8+1,e*8+1,7,1),t.fillRect(64+i*8+1,e*8+1,1,7);t.fillStyle(12103840);for(let e=0;e<4;e++)for(let i=0;i<4;i++)t.fillRect(64+i*8+1,e*8+7,7,1),t.fillRect(64+i*8+7,e*8+1,1,7);t.fillStyle(12096874),t.fillRect(96,0,32,32),t.fillStyle(10123336),t.fillRect(96,9,4,1),t.fillRect(96,20,4,1),t.fillRect(124,12,4,1),t.fillRect(124,24,4,1),t.fillStyle(5912704),t.fillRect(100,0,24,32),t.fillStyle(6965408),t.fillRect(102,0,20,32),t.fillStyle(9728200);for(let e=1;e<32;e+=8)t.fillRect(108,e,4,2),t.fillRect(106,e+2,8,2),t.fillRect(108,e+4,4,2);t.fillStyle(13934640),t.fillRect(100,0,2,32),t.fillRect(122,0,2,32),t.fillStyle(15780944),t.fillRect(101,0,1,32),t.fillRect(123,0,1,32)}drawTilesetWaterPark(t){t.fillStyle(14208440),t.fillRect(0,0,32,32),t.fillStyle(13813938),t.fillRect(0,0,16,16),t.fillRect(16,16,16,16),t.fillStyle(14537404),t.fillRect(16,0,16,16),t.fillRect(0,16,16,16),t.fillStyle(12102810);for(let e=0;e<=4;e++)t.fillRect(0,e*8,32,1);for(let e=0;e<=4;e++)t.fillRect(e*8,0,1,32);t.fillStyle(12629410),t.fillRect(5,3,1,1),t.fillRect(19,11,1,1),t.fillRect(12,22,1,1),t.fillRect(27,5,1,1),t.fillRect(3,26,1,1),t.fillRect(24,29,1,1),t.fillStyle(13156270),t.fillRect(14,0,4,8),t.fillStyle(14208440),t.fillRect(32,0,32,32),t.fillStyle(12102810);for(let e=0;e<=4;e++)t.fillRect(32,e*8,32,1);t.fillStyle(12892326),t.fillRect(35,3,6,2),t.fillRect(46,14,4,2),t.fillRect(54,25,5,2),t.fillStyle(13161688),t.fillRect(37,18,8,5),t.fillStyle(12563617),t.fillRect(40,6,1,1),t.fillRect(52,21,1,1),t.fillRect(34,28,1,1),t.fillStyle(15259800),t.fillRect(64,0,32,32),t.fillStyle(14207104);for(let e=0;e<3;e++)t.fillRect(64+e*11,4,8,6),t.fillRect(64+e*11+5,16,6,5);t.fillStyle(13154416),t.fillRect(66,2,1,1),t.fillRect(74,9,1,1),t.fillRect(83,3,1,1),t.fillRect(68,20,1,1),t.fillRect(80,27,1,1),t.fillRect(90,18,1,1),t.fillStyle(16313002),t.fillRect(70,12,2,1),t.fillRect(85,22,2,1),t.fillStyle(12101728),t.fillRect(64,30,32,2),t.fillStyle(4025127),t.fillRect(96,0,32,32),t.fillStyle(3498016),t.fillRect(96,0,16,16),t.fillRect(112,16,16,16),t.fillStyle(4683056),t.fillRect(112,0,16,16),t.fillRect(96,16,16,16),t.fillStyle(5934136);for(let e=0;e<4;e++)for(let i=0;i<4;i++)t.fillRect(96+i*8+e%2*3,e*8+1,2,5),t.fillRect(96+i*8+5-e%2*2,e*8+3,1,3);t.fillStyle(16777088),t.fillRect(101,10,2,2),t.fillStyle(2641176),t.fillRect(96,30,32,2)}drawTilesetPark(t){t.fillStyle(4025127),t.fillRect(0,0,32,32),t.fillStyle(3498016),t.fillRect(0,0,16,16),t.fillRect(16,16,16,16),t.fillStyle(4683056),t.fillRect(16,0,16,16),t.fillRect(0,16,16,16),t.fillStyle(5934136);for(let e=0;e<4;e++)for(let i=0;i<4;i++)t.fillRect(i*8+e%2*3,e*8+1,2,5),t.fillRect(i*8+5-e%2*2,e*8+3,1,3);t.fillStyle(7381056),t.fillRect(2,7,1,4),t.fillRect(25,3,1,5),t.fillRect(13,25,1,4),t.fillStyle(16777088),t.fillRect(5,10,2,2),t.fillStyle(16777215),t.fillRect(22,24,2,2),t.fillStyle(16751052),t.fillRect(14,18,2,2),t.fillStyle(8445248),t.fillRect(28,14,1,1),t.fillRect(9,29,1,1),t.fillStyle(2641176),t.fillRect(0,30,32,2),t.fillStyle(13150320),t.fillRect(32,0,32,32),t.fillStyle(12097642),t.fillRect(32,0,16,16),t.fillRect(48,16,16,16),t.fillStyle(13938810),t.fillRect(48,0,16,16),t.fillRect(32,16,16,16),t.fillStyle(10518608),t.fillRect(32,9,32,1),t.fillRect(32,21,32,1),t.fillStyle(9992264),t.fillRect(36,4,2,2),t.fillRect(44,15,2,2),t.fillRect(55,6,2,2),t.fillRect(38,26,2,2),t.fillRect(52,28,2,2),t.fillRect(48,3,1,1),t.fillStyle(14465672),t.fillRect(35,3,7,2),t.fillRect(50,13,5,2),t.fillRect(40,24,9,2),t.fillRect(56,19,6,2),t.fillStyle(3022352),t.fillRect(64,0,32,32),t.fillStyle(3811352),t.fillRect(64,0,16,16),t.fillRect(80,16,16,16),t.fillStyle(4468252),t.fillRect(80,0,16,16),t.fillRect(64,16,16,16),t.fillStyle(4246592),t.fillRect(66,2,1,5),t.fillRect(70,7,1,4),t.fillRect(79,12,1,5),t.fillRect(85,4,1,4),t.fillRect(74,20,1,5),t.fillRect(90,17,1,4),t.fillRect(67,26,1,4),t.fillRect(83,24,1,4),t.fillStyle(16728128),t.fillCircle(68,4,2),t.fillCircle(76,8,2),t.fillStyle(16772672),t.fillCircle(72,14,2),t.fillCircle(84,6,2),t.fillStyle(16744703),t.fillCircle(80,18,2),t.fillCircle(68,20,2),t.fillStyle(16777215),t.fillCircle(76,26,2),t.fillCircle(88,22,2),t.fillStyle(11158783),t.fillCircle(91,9,2),t.fillCircle(66,28,2),t.fillStyle(16777130),t.fillRect(67,3,1,1),t.fillRect(79,17,1,1),t.fillRect(75,25,1,1),t.fillStyle(8421504),t.fillRect(96,0,32,32),t.fillStyle(10526880),t.fillRect(97,1,12,9),t.fillRect(111,1,16,9),t.fillRect(97,12,16,9),t.fillRect(115,12,12,9),t.fillRect(97,23,10,8),t.fillRect(109,23,18,8),t.fillStyle(12237498),t.fillRect(97,1,12,1),t.fillRect(97,1,1,9),t.fillRect(111,1,16,1),t.fillRect(111,1,1,9),t.fillRect(97,12,16,1),t.fillRect(97,12,1,9),t.fillStyle(6842472),t.fillRect(97,9,12,1),t.fillRect(108,1,1,9),t.fillRect(111,9,16,1),t.fillRect(126,1,1,9),t.fillStyle(7368816),t.fillRect(96,10,32,2),t.fillRect(96,21,32,2),t.fillRect(109,0,2,10),t.fillRect(126,0,2,10),t.fillRect(113,12,2,9),t.fillRect(107,23,2,9),t.fillStyle(5275712),t.fillRect(98,10,2,2),t.fillRect(118,21,2,2),t.fillRect(110,0,1,2),t.fillRect(123,10,2,1)}drawTilesetCity(t){t.fillStyle(4210760),t.fillRect(0,0,32,32),t.fillStyle(3816002),t.fillRect(0,0,16,16),t.fillRect(16,16,16,16),t.fillStyle(4737104),t.fillRect(16,0,16,16),t.fillRect(0,16,16,16),t.fillStyle(5263448),t.fillRect(3,5,1,1),t.fillRect(11,2,1,1),t.fillRect(22,9,1,1),t.fillRect(7,19,1,1),t.fillRect(18,25,1,1),t.fillRect(29,14,1,1),t.fillRect(14,28,1,1),t.fillRect(25,3,1,1),t.fillRect(5,28,1,1),t.fillStyle(6052964),t.fillRect(8,8,1,1),t.fillRect(24,16,1,1),t.fillRect(16,24,1,1),t.fillStyle(3684416),t.fillRect(12,0,3,32),t.fillStyle(3026486),t.fillRect(0,30,32,2),t.fillStyle(11579576),t.fillRect(32,0,32,32),t.fillStyle(9474200);for(let e=0;e<=4;e++)t.fillRect(32,e*8,32,1);for(let e=0;e<=4;e++)t.fillRect(32+e*8,0,1,32);t.fillStyle(12632264);for(let e=0;e<4;e++)for(let i=0;i<4;i++)t.fillRect(32+i*8+1,e*8+1,7,7);t.fillStyle(13684952);for(let e=0;e<4;e++)for(let i=0;i<4;i++)t.fillRect(32+i*8+1,e*8+1,7,1),t.fillRect(32+i*8+1,e*8+1,1,7);t.fillStyle(10000544);for(let e=0;e<4;e++)for(let i=0;i<4;i++)t.fillRect(32+i*8+1,e*8+7,7,1),t.fillRect(32+i*8+7,e*8+1,1,7);t.fillStyle(10526888),t.fillRect(50,18,3,2),t.fillStyle(13682864),t.fillRect(64,0,32,32),t.fillStyle(12630176);for(let e=0;e<=4;e++)t.fillRect(64,e*8,32,1);for(let e=0;e<=4;e++)t.fillRect(64+e*8,0,1,32);t.fillStyle(14735552),t.fillRect(65,1,7,7),t.fillRect(81,9,7,7),t.fillRect(65,17,7,7),t.fillRect(81,25,7,7),t.fillStyle(11577480),t.fillRect(65,0,32,2),t.fillRect(64,30,32,2),t.fillStyle(11049072),t.fillRect(67,3,3,1),t.fillRect(83,11,4,1),t.fillRect(68,20,2,1),t.fillStyle(4210760),t.fillRect(96,0,32,32),t.fillStyle(4737104),t.fillRect(98,4,1,1),t.fillRect(118,22,1,1),t.fillRect(108,14,1,1),t.fillStyle(16763904),t.fillRect(110,0,4,13),t.fillRect(110,17,4,15),t.fillStyle(13936640),t.fillRect(110,0,1,13),t.fillRect(113,0,1,13),t.fillRect(110,17,1,15),t.fillRect(113,17,1,15)}buildWalls(){const t=`wall-L${this.levelNum}`;this.levelNum===1?this.ensureTexture(t,64,32,e=>{e.fillStyle(15657688),e.fillRect(0,0,64,32),e.fillStyle(15262924),e.fillRect(0,0,32,20),e.fillStyle(16052448),e.fillRect(32,0,32,20),e.fillStyle(14604998),e.fillRect(7,5,1,1),e.fillRect(22,12,1,1),e.fillRect(48,7,1,1),e.fillRect(14,18,1,1),e.fillRect(38,16,1,1),e.fillRect(58,4,1,1),e.fillRect(30,9,1,1),e.fillRect(52,19,1,1),e.fillRect(3,14,1,1),e.fillStyle(16709866),e.fillRect(0,0,64,3),e.fillStyle(16184032),e.fillRect(0,3,64,1),e.fillStyle(14538948),e.fillRect(0,19,64,2),e.fillStyle(14209210),e.fillRect(0,21,64,7),e.fillStyle(15526096),e.fillRect(0,21,64,1),e.fillStyle(13024414),e.fillRect(0,27,64,2),e.fillStyle(6840400),e.fillRect(0,29,64,3),e.fillStyle(13419694),e.fillRect(0,24,64,1)}):this.ensureTexture(t,8,8,e=>{e.fillStyle(4872312),e.fillRect(0,0,8,8),e.fillStyle(6846624),e.fillRect(0,3,8,2),e.fillStyle(4083310),e.fillRect(0,0,3,3),e.fillStyle(4872828),e.fillRect(4,0,4,3),e.fillStyle(3820138),e.fillRect(1,5,5,3),e.fillStyle(5795984),e.fillRect(0,7,8,1)});for(const e of this.cfg.walls)this.addStaticRect(this.wallGroup,e,t);this.wallGroup.refresh()}buildFurniture(){for(const t of this.cfg.furniture)this.addStaticRect(this.furnitureGroup,t.rect,t.textureKey);this.furnitureGroup.refresh()}buildLevelTextures(){switch(this.levelNum){case 1:this.buildTexturesHouse();break;case 2:this.buildTexturesWaterPark();break;case 3:this.buildTexturesPark();break;case 4:this.buildTexturesCity();break}this.ensureTexture("sparkle",8,8,t=>{t.fillStyle(11197951),t.fillCircle(4,4,4)}),this.ensureTexture("treat",10,10,t=>{t.fillStyle(30719),t.fillRect(0,0,10,10),t.fillStyle(2267647),t.fillRect(1,1,8,8),t.fillStyle(8965375),t.fillRect(1,1,3,2),t.fillStyle(17612),t.fillRect(0,8,10,2),t.fillRect(8,0,2,8)}),this.ensureTexture("pink-treat",12,12,t=>{t.fillStyle(16729258),t.fillRect(0,0,12,12),t.fillStyle(16742348),t.fillRect(1,1,10,10),t.fillStyle(16755438),t.fillRect(1,1,4,3),t.fillStyle(13369463),t.fillRect(0,10,12,2),t.fillRect(10,0,2,10),t.fillStyle(16777215),t.fillRect(5,1,2,4),t.fillRect(4,2,4,2)})}buildTexturesHouse(){this.ensureTexture("furniture-couch",72,28,t=>{t.fillStyle(3950712),t.fillRect(0,0,72,28),t.fillStyle(3819638),t.fillRect(0,0,72,8),t.fillStyle(5267608),t.fillRect(5,1,62,5),t.fillStyle(6320300),t.fillRect(6,1,60,3),t.fillStyle(7900364),t.fillRect(7,1,58,1),t.fillStyle(2897e3),t.fillRect(0,0,6,28),t.fillStyle(2897e3),t.fillRect(66,0,6,28),t.fillStyle(4741284),t.fillRect(0,0,6,3),t.fillStyle(4741284),t.fillRect(66,0,6,3),t.fillStyle(2238552),t.fillRect(5,0,1,28),t.fillStyle(2238552),t.fillRect(66,0,1,28),t.fillStyle(5004444),t.fillRect(6,8,60,16);const e=[7,28,49];for(const i of e)t.fillStyle(5796028),t.fillRect(i,9,19,13),t.fillStyle(6849232),t.fillRect(i+1,10,17,5),t.fillStyle(7903456),t.fillRect(i+3,10,11,2),t.fillStyle(3819648),t.fillRect(i,20,19,2),t.fillStyle(3029104),t.fillRect(i,22,19,1);t.fillStyle(2106440),t.fillRect(26,9,2,13),t.fillRect(47,9,2,13),t.fillStyle(3952784),t.fillRect(6,24,60,3),t.fillStyle(5267616),t.fillRect(6,24,60,1),t.fillStyle(2236448),t.fillRect(7,25,6,3),t.fillStyle(2236448),t.fillRect(59,25,6,3),t.fillStyle(4735040),t.fillRect(7,25,2,3),t.fillStyle(4735040),t.fillRect(59,25,2,3),t.fillStyle(8921136),t.fillRect(7,1,16,7),t.fillStyle(11544640),t.fillRect(9,2,12,4),t.fillStyle(13381712),t.fillRect(10,2,10,2),t.fillStyle(6690856),t.fillRect(7,7,16,1),t.fillStyle(9461792),t.fillRect(49,1,16,7),t.fillStyle(12222512),t.fillRect(51,2,12,4),t.fillStyle(13672512),t.fillRect(52,2,10,2),t.fillStyle(7358488),t.fillRect(49,7,16,1)}),this.ensureTexture("furniture-table",48,32,t=>{t.fillStyle(12884560),t.fillRect(0,0,48,32),t.fillStyle(13937240),t.fillRect(0,0,25,8),t.fillStyle(12226632),t.fillRect(25,0,23,8),t.fillStyle(13673552),t.fillRect(0,8,32,8),t.fillStyle(12095552),t.fillRect(32,8,16,8),t.fillStyle(12884048),t.fillRect(0,16,18,8),t.fillStyle(14200928),t.fillRect(18,16,30,8),t.fillStyle(12359240),t.fillRect(0,24,28,8),t.fillStyle(13675096),t.fillRect(28,24,20,8),t.fillStyle(11043384),t.fillRect(0,8,48,1),t.fillRect(0,16,48,1),t.fillRect(0,24,48,1),t.fillStyle(10121264),t.fillRect(24,0,1,8),t.fillRect(31,8,1,8),t.fillRect(17,16,1,8),t.fillRect(27,24,1,8),t.fillStyle(14727784),t.fillRect(3,2,16,1),t.fillRect(28,4,12,1),t.fillRect(2,10,24,1),t.fillRect(34,13,10,1),t.fillRect(6,18,8,1),t.fillRect(22,21,18,1),t.fillRect(4,26,18,1),t.fillRect(30,29,14,1),t.fillStyle(8937520),t.fillRect(14,10,4,3),t.fillStyle(10516544),t.fillRect(15,11,2,1),t.fillStyle(8018984),t.fillRect(0,0,5,5),t.fillRect(43,0,5,5),t.fillRect(0,27,5,5),t.fillRect(43,27,5,5),t.fillStyle(10123328),t.fillRect(0,0,5,1),t.fillRect(0,0,1,5),t.fillRect(43,0,5,1),t.fillRect(43,0,1,5),t.fillStyle(10123312),t.fillRect(44,0,4,32),t.fillRect(0,28,44,4),t.fillStyle(14465128),t.fillRect(0,0,44,2),t.fillRect(0,0,2,28),t.fillStyle(3831992),t.fillRect(8,9,7,12),t.fillStyle(5937880),t.fillRect(9,9,5,4),t.fillStyle(2644128),t.fillRect(8,19,7,2),t.fillStyle(2777120),t.fillRect(11,5,2,5),t.fillStyle(16728176),t.fillCircle(12,4,3),t.fillStyle(16744592),t.fillRect(10,3,4,2),t.fillStyle(5288e3),t.fillRect(8,7,2,2),t.fillStyle(5288e3),t.fillRect(14,7,2,2),t.fillStyle(1710624),t.fillRect(33,11,8,14),t.fillStyle(2763312),t.fillRect(34,12,6,12),t.fillStyle(13381680),t.fillRect(35,13,4,2),t.fillStyle(8947848),t.fillRect(35,17,1,1),t.fillRect(37,17,1,1),t.fillRect(35,19,1,1),t.fillRect(37,19,1,1),t.fillRect(35,21,1,1),t.fillRect(37,21,1,1)}),this.ensureTexture("furniture-bookshelf",28,48,t=>{t.fillStyle(3022864),t.fillRect(0,0,28,48),t.fillStyle(4863008),t.fillRect(0,0,2,48),t.fillStyle(1840136),t.fillRect(26,0,2,48),t.fillStyle(5914664),t.fillRect(2,0,24,48),t.fillStyle(3811352),t.fillRect(2,10,24,2),t.fillRect(2,22,24,2),t.fillRect(2,34,24,2),t.fillRect(2,46,24,2),t.fillStyle(6967352),t.fillRect(2,10,24,1),t.fillRect(2,22,24,1),t.fillRect(2,34,24,1),t.fillRect(2,46,24,1);const e=[[2,4,"#cc2828"],[5,4,"#3060cc"],[8,4,"#208840"],[11,4,"#c89820"],[14,4,"#804488"],[17,4,"#c84820"],[21,3,"#285890"],[24,4,"#9a2020"]];for(const[r,o,h]of e)t.fillStyle(parseInt(h.slice(1),16)),t.fillRect(r,1,o,8),t.fillStyle(16777215),t.fillRect(r,1,1,8);const i=[[2,4,"#c86020"],[6,4,"#308848"],[10,3,"#cc2828"],[13,5,"#304888"],[18,4,"#c8a840"],[22,4,"#5c3088"]];for(const[r,o,h]of i)t.fillStyle(parseInt(h.slice(1),16)),t.fillRect(r,13,o,8),t.fillStyle(16777215),t.fillRect(r,13,1,8);const s=[[2,3,"#2860cc"],[5,4,"#884488"],[9,4,"#c89020"],[13,3,"#cc3028"],[16,4,"#208048"],[20,4,"#c04820"],[24,3,"#305888"]];for(const[r,o,h]of s)t.fillStyle(parseInt(h.slice(1),16)),t.fillRect(r,25,o,8),t.fillStyle(16777215),t.fillRect(r,25,1,8);const l=[[2,4,"#cc2828"],[6,4,"#30a050"],[10,3,"#3060cc"],[13,5,"#c8a840"]];for(const[r,o,h]of l)t.fillStyle(parseInt(h.slice(1),16)),t.fillRect(r,37,o,8),t.fillStyle(16777215),t.fillRect(r,37,1,8);t.fillStyle(7360560),t.fillRect(19,37,8,8),t.fillStyle(15788248),t.fillRect(20,38,6,6),t.fillStyle(5275808),t.fillRect(21,39,4,4)}),this.ensureTexture("furniture-kitchen-table",56,40,t=>{t.fillStyle(14731392),t.fillRect(0,0,56,40),t.fillStyle(13941360),t.fillRect(0,0,28,10),t.fillStyle(15519376),t.fillRect(28,0,28,10),t.fillStyle(15256200),t.fillRect(0,10,36,10),t.fillStyle(14203e3),t.fillRect(36,10,20,10),t.fillStyle(14335096),t.fillRect(0,20,22,10),t.fillStyle(15650448),t.fillRect(22,20,34,10),t.fillStyle(14993538),t.fillRect(0,30,40,10),t.fillStyle(13809256),t.fillRect(40,30,16,10),t.fillStyle(12097616),t.fillRect(0,10,56,1),t.fillRect(0,20,56,1),t.fillRect(0,30,56,1),t.fillStyle(11176e3),t.fillRect(27,0,1,10),t.fillRect(35,10,1,10),t.fillRect(21,20,1,10),t.fillRect(39,30,1,10),t.fillStyle(16309920),t.fillRect(4,2,18,1),t.fillRect(32,5,16,1),t.fillRect(3,12,28,1),t.fillRect(38,17,14,1),t.fillRect(6,22,10,1),t.fillRect(26,27,20,1),t.fillRect(5,32,30,1),t.fillRect(42,37,10,1),t.fillStyle(10123312),t.fillRect(0,0,6,6),t.fillRect(50,0,6,6),t.fillRect(0,34,6,6),t.fillRect(50,34,6,6),t.fillStyle(12095552),t.fillRect(0,0,6,1),t.fillRect(0,0,1,6),t.fillRect(50,0,6,1),t.fillRect(50,0,1,6),t.fillStyle(11571264),t.fillRect(0,36,50,4),t.fillRect(52,0,4,40),t.fillStyle(16310432),t.fillRect(0,0,50,2),t.fillRect(0,0,2,36),t.fillStyle(16446168),t.fillEllipse(28,20,36,24),t.fillStyle(15788232),t.fillEllipse(28,20,28,18),t.fillStyle(9070632),t.fillCircle(28,20,8),t.fillStyle(11044908),t.fillCircle(27,19,7),t.fillStyle(15609904),t.fillCircle(25,18,3),t.fillStyle(16748576),t.fillCircle(31,17,3),t.fillStyle(4246576),t.fillCircle(28,23,3),t.fillStyle(16736416),t.fillCircle(24,23,2),t.fillStyle(13150280),t.fillRect(22,12,12,1)}),this.ensureTexture("bush",8,8,t=>{t.fillStyle(1989662),t.fillRect(0,0,8,8),t.fillStyle(3178544),t.fillCircle(2.5,3,2.5),t.fillCircle(5.5,2,2),t.fillCircle(4,6,2.5),t.fillCircle(7,5.5,1.5),t.fillStyle(5283920),t.fillCircle(2,2,1),t.fillCircle(6,1,1),t.fillStyle(1591320),t.fillRect(0,7,8,1),t.fillRect(7,0,1,8)}),this.ensureTexture("bush-shed",24,24,t=>{t.fillStyle(12101768),t.fillRect(0,0,24,24),t.fillStyle(6318200),t.fillRect(0,0,24,8),t.fillStyle(5265512);for(let e=0;e<24;e+=3)t.fillRect(e,0,1,8);t.fillStyle(8423576),t.fillRect(0,7,24,1),t.fillStyle(10127464),t.fillRect(0,8,24,1),t.fillRect(0,14,24,1),t.fillRect(0,20,24,1),t.fillRect(0,23,24,1),t.fillRect(0,8,1,16),t.fillRect(23,8,1,16),t.fillStyle(8017968),t.fillRect(9,14,6,9),t.fillStyle(5914656),t.fillRect(8,13,8,1),t.fillRect(8,23,8,1),t.fillRect(8,13,1,10),t.fillRect(15,13,1,10),t.fillStyle(9070656),t.fillRect(10,15,4,4),t.fillRect(10,20,4,2),t.fillStyle(13936672),t.fillRect(14,18,1,2),t.fillStyle(9091288),t.fillRect(2,11,4,4),t.fillRect(18,11,4,4),t.fillStyle(10127464),t.fillRect(2,11,4,1),t.fillRect(2,14,4,1),t.fillRect(2,11,1,4),t.fillRect(5,11,1,4),t.fillRect(18,11,4,1),t.fillRect(18,14,4,1),t.fillRect(18,11,1,4),t.fillRect(21,11,1,4),t.fillRect(3,12,2,1),t.fillRect(4,11,1,3),t.fillRect(19,12,2,1),t.fillRect(20,11,1,3),t.fillStyle(13954808),t.fillRect(3,11,1,1),t.fillRect(19,11,1,1)})}buildTexturesWaterPark(){this.ensureTexture("wpark-pool",32,32,t=>{t.fillStyle(26777),t.fillRect(0,0,32,32),t.fillStyle(35020),t.fillRect(2,2,28,28),t.fillStyle(43758),t.fillRect(5,5,22,22),t.fillStyle(2277616);for(let e=4;e<32;e+=7)for(let i=0;i<32;i+=8)t.fillRect(i,e,5,2);t.fillStyle(8969727),t.fillRect(4,6,6,2),t.fillRect(19,13,5,2),t.fillRect(9,21,8,2),t.fillRect(24,4,3,2),t.fillStyle(21879),t.fillRect(0,0,32,2),t.fillRect(0,0,2,32),t.fillStyle(16777215),t.fillRect(15,15,2,2)}),this.ensureTexture("wpark-wading",32,32,t=>{t.fillStyle(43656),t.fillRect(0,0,32,32),t.fillStyle(52394),t.fillRect(2,2,28,28),t.fillStyle(61115);for(let e=4;e<32;e+=8)t.fillRect(2,e,28,2);t.fillStyle(11206638),t.fillRect(6,8,5,2),t.fillRect(18,18,7,2),t.fillStyle(16777215),t.fillRect(2,28,28,2),t.fillStyle(34918),t.fillRect(0,0,32,2),t.fillRect(0,0,2,32)}),this.ensureTexture("wpark-slide",32,32,t=>{t.fillStyle(14712864),t.fillRect(0,0,32,32),t.fillStyle(16752704),t.fillRect(2,2,28,8),t.fillStyle(16764e3),t.fillRect(4,3,24,2),t.fillStyle(12083216),t.fillRect(2,9,28,1),t.fillStyle(8405008),t.fillRect(13,10,6,22),t.fillStyle(11165728),t.fillRect(14,10,2,22),t.fillStyle(13393936);for(let e=12;e<32;e+=6)t.fillRect(0,e,12,3);t.fillStyle(16748592);for(let e=12;e<32;e+=6)t.fillRect(20,e,12,3);t.fillStyle(14540253),t.fillRect(0,2,2,8),t.fillRect(30,2,2,8)}),this.ensureTexture("wpark-snack",32,32,t=>{t.fillStyle(15786176),t.fillRect(0,0,32,32),t.fillStyle(14491680);for(let e=0;e<32;e+=6)t.fillRect(e,0,3,10);t.fillStyle(11141120),t.fillRect(0,8,32,2),t.fillStyle(16777215),t.fillRect(0,10,32,1),t.fillStyle(13940880),t.fillRect(2,11,28,20),t.fillStyle(16444368),t.fillRect(0,16,32,5),t.fillStyle(12095584),t.fillRect(0,21,32,1),t.fillStyle(9070144),t.fillRect(8,11,16,4),t.fillStyle(11206621),t.fillRect(9,12,14,3),t.fillStyle(6307872),t.fillRect(12,22,8,9),t.fillStyle(8015920),t.fillRect(13,23,6,7),t.fillStyle(13936672),t.fillRect(18,26,1,2)}),this.ensureTexture("wpark-cabin",32,32,t=>{t.fillStyle(9071178),t.fillRect(0,0,32,32),t.fillStyle(6965802);for(let e=5;e<32;e+=5)t.fillRect(0,e,32,1);t.fillStyle(11042912);for(let e=4;e<32;e+=5)t.fillRect(0,e,32,1);t.fillStyle(5913114),t.fillRect(0,0,32,1),t.fillRect(0,0,1,32),t.fillRect(31,0,1,32),t.fillRect(0,31,32,1),t.fillStyle(9091288),t.fillRect(4,6,8,8),t.fillRect(20,6,8,8),t.fillStyle(6965802),t.fillRect(4,10,8,1),t.fillRect(8,6,1,8),t.fillRect(20,10,8,1),t.fillRect(24,6,1,8),t.fillStyle(13954808),t.fillRect(5,7,2,2),t.fillRect(21,7,2,2),t.fillStyle(8015920),t.fillRect(12,18,8,14),t.fillStyle(5912600),t.fillRect(12,18,8,1),t.fillRect(12,18,1,14),t.fillRect(19,18,1,14),t.fillStyle(13936672),t.fillRect(18,25,1,2)}),this.ensureTexture("wpark-lounge",16,8,t=>{t.fillStyle(15645508),t.fillRect(0,0,16,8),t.fillStyle(4508842),t.fillRect(3,1,2,6),t.fillRect(8,1,2,6),t.fillRect(13,1,2,6),t.fillStyle(16768392),t.fillRect(0,0,3,7),t.fillStyle(16772778),t.fillRect(0,1,3,5),t.fillStyle(11175960),t.fillRect(0,0,16,1),t.fillRect(0,7,16,1),t.fillRect(0,0,1,8),t.fillRect(15,0,1,8)})}buildTexturesPark(){this.ensureTexture("park-fountain",32,32,t=>{t.fillStyle(9476776),t.fillRect(0,0,32,32),t.fillStyle(8425632),t.fillCircle(16,16,15),t.fillStyle(11582152),t.fillCircle(16,14,14),t.fillStyle(30668),t.fillCircle(16,16,11),t.fillStyle(5614335),t.fillCircle(16,16,7),t.fillStyle(10083839),t.fillRect(12,14,4,2),t.fillRect(18,18,3,2),t.fillStyle(11197951),t.fillCircle(16,10,3),t.fillStyle(16777215),t.fillRect(15,4,2,8),t.fillStyle(13430527),t.fillRect(9,9,2,3),t.fillRect(7,8,2,2),t.fillRect(21,9,2,3),t.fillRect(23,8,2,2),t.fillStyle(6318200),t.fillRect(0,28,32,4),t.fillRect(28,0,4,32)}),this.ensureTexture("park-pond",32,32,t=>{t.fillStyle(17510),t.fillRect(0,0,32,32),t.fillStyle(24456),t.fillRect(2,2,28,28),t.fillStyle(31402),t.fillRect(4,4,24,24),t.fillStyle(39372);for(let e=6;e<28;e+=7)for(let i=4;i<28;i+=9)t.fillRect(i,e,5,2);t.fillStyle(5618653),t.fillRect(8,10,5,2),t.fillRect(20,18,4,2),t.fillStyle(3186720),t.fillCircle(22,8,4),t.fillStyle(5294144),t.fillCircle(21,7,2),t.fillStyle(16729224),t.fillCircle(22,6,1),t.fillStyle(13141),t.fillRect(0,0,32,2),t.fillRect(0,0,2,32)}),this.ensureTexture("park-tree",44,44,t=>{t.fillStyle(8015920),t.fillRect(19,28,6,14),t.fillStyle(5912600),t.fillRect(23,28,2,14),t.fillStyle(1858588),t.fillCircle(22,18,16),t.fillStyle(2783280),t.fillCircle(22,16,13),t.fillStyle(3707434),t.fillCircle(14,14,7),t.fillCircle(28,13,8),t.fillCircle(20,8,6),t.fillCircle(27,21,6),t.fillStyle(5814336),t.fillCircle(16,10,4),t.fillCircle(25,9,4),t.fillCircle(12,18,3),t.fillCircle(30,17,3),t.fillStyle(7917640),t.fillCircle(20,6,3),t.fillCircle(24,12,2),t.fillStyle(16755404),t.fillRect(15,8,2,2),t.fillRect(25,14,2,2),t.fillStyle(16764125),t.fillRect(19,5,1,1),t.fillRect(28,19,1,1)}),this.ensureTexture("park-bench",32,12,t=>{t.fillStyle(4204560),t.fillRect(0,0,32,12),t.fillStyle(10119744);for(let e=0;e<32;e+=8)t.fillRect(e+1,1,6,5);t.fillStyle(12091472);for(let e=0;e<32;e+=8)t.fillRect(e+1,1,6,1);t.fillStyle(8015912);for(let e=0;e<32;e+=8)t.fillRect(e+1,5,6,1);t.fillStyle(8421520),t.fillRect(2,6,3,5),t.fillRect(27,6,3,5),t.fillStyle(10526896),t.fillRect(2,6,1,5),t.fillRect(27,6,1,5)}),this.ensureTexture("park-swings",32,32,t=>{t.fillStyle(8947848),t.fillRect(0,0,32,32),t.fillStyle(7372880),t.fillRect(0,22,32,10),t.fillStyle(5263456),t.fillRect(0,0,32,3),t.fillStyle(7368864),t.fillRect(0,0,32,1),t.fillStyle(6316128),t.fillRect(0,0,3,22),t.fillRect(29,0,3,22),t.fillStyle(3684408),t.fillRect(6,3,2,14),t.fillRect(14,3,2,14),t.fillRect(22,3,2,14),t.fillStyle(6842472),t.fillRect(7,3,1,14),t.fillRect(15,3,1,14),t.fillRect(23,3,1,14),t.fillStyle(13382451),t.fillRect(4,17,6,3),t.fillStyle(3368652),t.fillRect(12,17,6,3),t.fillStyle(13408546),t.fillRect(20,17,6,3)}),this.ensureTexture("park-sandbox",32,32,t=>{t.fillStyle(10518592),t.fillRect(0,0,32,32),t.fillStyle(12623968),t.fillRect(0,0,32,3),t.fillRect(0,0,3,32),t.fillStyle(8413232),t.fillRect(29,0,3,32),t.fillRect(0,29,32,3),t.fillStyle(15259776),t.fillRect(3,3,26,26),t.fillStyle(14207088),t.fillRect(3,3,12,12),t.fillRect(18,16,11,13),t.fillStyle(16314026),t.fillRect(10,8,6,5),t.fillRect(20,6,7,4),t.fillStyle(14496563),t.fillRect(19,4,5,5),t.fillStyle(16733525),t.fillRect(20,4,3,1),t.fillStyle(11149858),t.fillRect(19,8,5,1),t.fillStyle(9064480),t.fillRect(7,20,2,7),t.fillStyle(13148240),t.fillRect(5,19,6,3)})}buildTexturesCity(){this.ensureTexture("city-building",32,32,t=>{t.fillStyle(7895160),t.fillRect(0,0,32,32),t.fillStyle(6842472),t.fillRect(0,10,32,1),t.fillRect(0,20,32,1),t.fillRect(0,0,32,2),t.fillRect(0,30,32,2),t.fillRect(0,0,2,32),t.fillRect(30,0,2,32),t.fillStyle(9605778),t.fillRect(0,0,32,1),t.fillRect(0,0,1,32),t.fillStyle(16771200),t.fillRect(4,3,5,5),t.fillRect(12,3,5,5),t.fillRect(20,3,5,5),t.fillRect(28,3,2,5),t.fillRect(4,13,5,5),t.fillRect(20,13,5,5),t.fillStyle(4874352),t.fillRect(12,13,5,5),t.fillRect(28,13,2,5),t.fillRect(4,23,5,5),t.fillRect(20,23,5,5),t.fillStyle(16767072),t.fillRect(12,23,5,5),t.fillStyle(5263440);for(let e=3;e<28;e+=10)for(let i=4;i<28;i+=8)t.fillRect(i,e,5,1),t.fillRect(i,e,1,5),t.fillRect(i+2,e,1,5);t.fillStyle(3815994),t.fillRect(13,24,6,8),t.fillStyle(5605546),t.fillRect(14,25,4,7),t.fillStyle(8960972),t.fillRect(14,25,2,2)}),this.ensureTexture("city-car",16,24,t=>{t.fillStyle(13377568),t.fillRect(0,0,16,24),t.fillStyle(14499904),t.fillRect(1,0,14,1),t.fillStyle(9091288),t.fillRect(2,3,12,6),t.fillStyle(13426158),t.fillRect(2,3,5,2),t.fillStyle(6986424),t.fillRect(2,16,12,5),t.fillStyle(10075092),t.fillRect(2,16,4,2),t.fillStyle(1710618),t.fillRect(0,2,3,5),t.fillRect(13,2,3,5),t.fillRect(0,17,3,5),t.fillRect(13,17,3,5),t.fillStyle(8947848),t.fillRect(0,3,1,3),t.fillRect(15,3,1,3),t.fillRect(0,18,1,3),t.fillRect(15,18,1,3),t.fillStyle(15615044),t.fillRect(2,9,12,7),t.fillStyle(11147288),t.fillRect(7,9,2,7)})}buildTreats(){const i=[];for(let s=-160;s<=160;s+=16)for(let l=-160;l<=160;l+=16)i.push([l,s]);i.sort(([s,l],[r,o])=>s*s+l*l-r*r-o*o);for(const s of this.cfg.treatPositions){let l=this.cfg.playerStart.x+40,r=this.cfg.playerStart.y;for(const[a,p]of i)if(this.isWalkable(s.x+a,s.y+p)){l=s.x+a,r=s.y+p;break}const o=this.treatGroup.create(l,r,"treat");o.setDisplaySize(12,12),o.setDepth(9990),o.refreshBody();const h=this.add.particles(l,r,"sparkle",{lifespan:700,speed:{min:12,max:28},scale:{start:.55,end:0},alpha:{start:.8,end:0},quantity:1,frequency:900,blendMode:u.BlendModes.ADD});h.setDepth(9991),o.setData("emitter",h)}this.treatGroup.refresh()}buildDecoratives(){switch(this.levelNum){case 1:this.buildDecorativesHouse();break;case 2:this.buildDecorativesWaterPark();break;case 3:this.buildDecorativesPark();break;case 4:this.buildDecorativesCity();break}}buildDecorativesHouse(){const t=this.add.graphics();t.fillStyle(8000789),t.fillRoundedRect(32,86,264,158,10),t.fillStyle(10102053),t.fillRoundedRect(40,94,248,142,7),t.fillStyle(6950928),t.fillRect(40,94,248,4),t.fillRect(40,232,248,4),t.fillRect(40,94,4,142),t.fillRect(284,94,4,142),t.fillStyle(12599360);for(let n=0;n<120;n+=20)t.fillRect(56,106+n,4,4),t.fillRect(264,106+n,4,4);t.fillStyle(13936672),t.fillRect(80,130,164,2),t.fillRect(80,200,164,2),t.setDepth(.5);const e=this.add.graphics();e.fillStyle(3824170),e.fillRoundedRect(42,445,135,96,6),e.fillStyle(4878392),e.fillRoundedRect(50,452,119,82,4),e.fillStyle(5931080);for(let n=0;n<6;n++)e.fillRect(55,460+n*12,109,4);e.setDepth(.5);const i=this.add.graphics();i.fillStyle(10129536),i.fillRect(492,424,80,154),i.fillStyle(8945776);for(let n=424;n<578;n+=26)i.fillRect(492,n,80,2);for(let n=492;n<572;n+=26)i.fillRect(n,424,2,154);i.fillStyle(7368800),i.fillRect(492,575,80,3),i.fillRect(569,424,3,154),i.setDepth(.5);for(let n=28;n<=405;n+=28)this.add.rectangle(492,n+12,5,22,12095568).setDepth(n+22);for(let n=588;n<=738;n+=28)this.add.rectangle(492,n+12,5,22,12095568).setDepth(n+22);this.add.rectangle(492,428,7,20,9461808).setDepth(438),this.add.rectangle(492,572,7,20,9461808).setDepth(582),this.ensureTexture("tree",48,48,n=>{n.fillStyle(8015920),n.fillRect(21,30,6,14),n.fillStyle(6963232),n.fillRect(22,30,1,14),n.fillRect(25,32,1,10),n.fillStyle(1858588),n.fillCircle(24,20,18),n.fillStyle(2783280),n.fillCircle(24,18,15),n.fillStyle(3707434),n.fillCircle(16,16,7),n.fillCircle(30,15,8),n.fillCircle(22,10,7),n.fillCircle(28,22,6),n.fillStyle(5814336),n.fillCircle(18,12,5),n.fillCircle(26,11,4)});for(const n of[{x:632,y:300},{x:882,y:345}])this.add.image(n.x,n.y,"tree").setDepth(n.y+18);const s=[{x:270,y:60,fw:40,fh:30},{x:190,y:60,fw:36,fh:28}];for(const n of s)this.add.rectangle(n.x,n.y,n.fw,n.fh,3811864).setDepth(.6),this.add.rectangle(n.x,n.y,n.fw-4,n.fh-4,15788248).setDepth(.7),this.add.rectangle(n.x-2,n.y-2,n.fw-12,n.fh-12,5275808).setDepth(.8);const l=this.add.graphics();l.fillStyle(4210752),l.fillRect(228,80,4,32),l.fillStyle(16772744),l.fillEllipse(230,80,22,12),l.fillStyle(13404160),l.fillRect(224,108,12,4),l.setDepth(115);const r=this.add.graphics();r.fillStyle(8405024),r.fillRect(330,155,14,12),r.fillStyle(6303760),r.fillRect(328,163,18,4),r.fillStyle(2129952),r.fillCircle(337,148,9),r.fillStyle(3186736),r.fillCircle(333,144,6),r.fillCircle(341,145,7),r.fillStyle(5292112),r.fillCircle(335,140,4),r.fillCircle(341,141,4),r.setDepth(165);const o=this.add.graphics();o.fillStyle(16777164,.12),o.fillRect(600,90,40,70),o.fillRect(760,120,40,60),o.fillStyle(16777160,.06),o.fillRect(605,160,35,50),o.fillRect(765,180,35,40),o.setDepth(.4);const h=this.add.graphics();h.fillStyle(4864552),h.fillRoundedRect(38,730,50,30,4),h.fillStyle(6967352),h.fillRoundedRect(42,734,42,22,3),h.fillStyle(9070664);for(let n=0;n<4;n++)h.fillRect(44,736+n*5,38,3);h.setDepth(.5);const a=this.add.graphics();a.fillStyle(16315624),a.fillRect(20,18,354,3),a.fillRect(390,18,100,3),a.fillRect(506,18,498,3),a.fillRect(20,748,470,3),a.fillRect(506,748,498,3),a.fillRect(18,20,3,372),a.fillRect(18,408,3,340),a.fillRect(1003,20,3,728),a.fillRect(20,390,130,3),a.fillRect(20,406,130,3),a.fillRect(371,20,3,80),a.fillRect(390,20,3,80),a.fillRect(371,220,3,200),a.fillRect(390,220,3,200),a.fillRect(487,20,3,400),a.fillRect(506,20,3,400),a.fillRect(487,580,3,168),a.fillRect(506,580,3,168),a.fillStyle(9076832),a.fillRect(20,21,354,1),a.fillRect(390,21,100,1),a.fillRect(506,21,498,1),a.fillRect(20,750,470,1),a.fillRect(506,750,498,1),a.setDepth(.45);const p=[[30,50,180,70,85],[50,240,120,80,280],[295,50,70,120,110],[40,450,140,100,500],[550,60,80,80,100],[740,80,90,90,125],[750,480,90,70,515],[870,620,120,120,680]];for(const[n,G,A,E,K]of p){const C=this.add.graphics();C.fillStyle(0,.2),C.fillRect(n+4,G+6,A,E),C.setDepth(K-.2)}const f=this.add.graphics();f.fillStyle(6320308),f.fillRect(30,50,6,70),f.fillStyle(7899340),f.fillRect(30,50,6,4),f.fillStyle(6320308),f.fillRect(204,50,6,70),f.fillStyle(7899340),f.fillRect(204,50,6,4),f.fillStyle(8425676),f.fillRect(36,50,168,4),f.setDepth(85.5);const w=this.add.graphics();w.fillStyle(16767088,.4),w.fillRect(50,240,120,6),w.fillStyle(16771216,.25),w.fillRect(50,246,120,4),w.setDepth(280.5);const d=this.add.graphics();d.fillStyle(6982224),d.fillEllipse(110,460,55,22),d.fillEllipse(110,540,55,22),d.fillEllipse(55,500,22,55),d.fillEllipse(165,500,22,55),d.fillStyle(9087600),d.fillEllipse(109,459,45,14),d.fillEllipse(109,539,45,14),d.fillStyle(11577480),d.fillRect(98,452,1,10),d.fillRect(120,452,1,10),d.fillRect(98,532,1,10),d.fillRect(120,532,1,10),d.setDepth(500.5);const S=this.add.graphics();S.fillStyle(6967352),S.fillRect(295,50,70,3),S.fillStyle(9070664),S.fillRect(295,50,70,1),S.fillStyle(7354400),S.fillRect(318,52,14,9),S.fillStyle(5249544),S.fillRect(316,58,18,3),S.fillStyle(2129952),S.fillCircle(325,47,8),S.fillStyle(3186736),S.fillCircle(321,44,5),S.fillStyle(3186736),S.fillCircle(329,44,5),S.fillStyle(5292112),S.fillCircle(325,41,4),S.setDepth(110.5)}buildDecorativesWaterPark(){const t=this.add.graphics();t.lineStyle(2,16777215,.5);for(let h=160;h<480;h+=64)t.beginPath(),t.moveTo(h,200),t.lineTo(h,460),t.strokePath();t.fillStyle(14492194);for(let h=160;h<480;h+=64)for(let a=210;a<460;a+=30)t.fillCircle(h,a,3);t.fillStyle(16777215);for(let h=160;h<480;h+=64)for(let a=225;a<460;a+=30)t.fillCircle(h,a,3);t.fillStyle(16763904),t.fillRect(100,198,8,4),t.fillRect(100,458,8,4),t.fillRect(476,198,8,4),t.fillRect(476,458,8,4),t.setDepth(.6);const e=this.add.graphics();e.fillStyle(13154456,.7),e.fillRect(180,460,60,240),e.fillStyle(12101768,.5);for(let h=470;h<700;h+=24)e.fillRect(185,h,50,8);e.setDepth(.5),this.add.text(940,95,"SNACKS",{fontSize:"12px",color:"#ffffff",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(200),this.add.text(940,110,"🌭 🍦 🥤",{fontSize:"9px"}).setOrigin(.5).setDepth(200);const i=[13378082,2254540,2271812,13404160],s=[{x:120,y:120},{x:220,y:120},{x:320,y:120},{x:420,y:120},{x:120,y:480},{x:220,y:480},{x:320,y:480}];for(let h=0;h<s.length;h++){const a=s[h],p=i[h%i.length];this.add.rectangle(a.x,a.y+8,2,20,8947848).setDepth(a.y-5);const f=this.add.graphics();f.fillStyle(p,.85),f.fillEllipse(a.x,a.y-2,28,12),f.fillStyle(16777215,.5),f.fillRect(a.x-13,a.y-4,5,8),f.fillRect(a.x,a.y-4,5,8),f.setDepth(a.y-4)}const l=this.add.graphics();l.fillStyle(15606306),l.fillCircle(94,330,12),l.fillStyle(16777215),l.fillCircle(94,330,8),l.fillStyle(15606306),l.fillRect(90,318,8,4),l.fillRect(90,340,8,4),l.fillRect(82,326,4,8),l.fillRect(102,326,4,8),l.fillStyle(16777215),l.fillCircle(94,330,4),l.setDepth(340);const r=this.add.graphics();r.fillStyle(11193565,.35);for(let h=0;h<8;h++){const a=h%2===0?-6:6;r.fillEllipse(210+a,465+h*22,8,12)}r.setDepth(.55),this.add.rectangle(504,180,3,30,5263440).setDepth(200),this.add.rectangle(504,165,44,22,16777215).setDepth(201),this.add.rectangle(504,165,42,20,1721514).setDepth(202),this.add.text(504,165,`NO
RUNNING`,{fontSize:"7px",color:"#ffffff",align:"center"}).setOrigin(.5).setDepth(203);const o=this.add.graphics();o.fillStyle(39372,.7),o.fillEllipse(640,300,60,30),o.fillStyle(4504558,.5),o.fillEllipse(638,296,40,18),o.setDepth(.55)}buildDecorativesPark(){const t=this.add.graphics();t.fillStyle(13150320,.85),t.fillRect(100,460,440,32),t.fillRect(590,100,32,360),t.fillRect(660,452,200,32),t.fillStyle(14203008,.5),t.fillRect(100,473,440,8),t.fillRect(598,100,12,360),t.fillRect(660,462,200,10),t.setDepth(.5);const e=this.add.graphics();e.fillStyle(3811352),e.fillEllipse(700,700,80,50),e.fillStyle(16728128);for(const r of[{x:678,y:696},{x:708,y:706},{x:695,y:688}])e.fillCircle(r.x,r.y,5);e.fillStyle(16772672),e.fillCircle(688,706,4),e.fillCircle(715,698,4),e.fillStyle(16746751),e.fillCircle(702,694,4),e.fillStyle(5295184);for(let r=676;r<720;r+=7)e.fillRect(r,698,1,5);e.fillStyle(3811352),e.fillEllipse(300,200,60,40),e.fillStyle(16777024);for(const r of[{x:286,y:196},{x:306,y:202},{x:298,y:190}])e.fillCircle(r.x,r.y,4);e.fillStyle(16736400),e.fillCircle(312,196,4),e.fillStyle(16777215),e.fillCircle(290,205,3),e.fillStyle(3811352),e.fillEllipse(1100,500,70,45),e.fillStyle(11158783),e.fillCircle(1086,496,4),e.fillCircle(1108,502,4),e.fillCircle(1097,490,5),e.fillStyle(16755264),e.fillCircle(1112,494,4),e.fillCircle(1084,507,4),e.setDepth(.6);const i=this.add.graphics();i.fillStyle(12101744,.6);for(const r of[{x:190,y:375},{x:190,y:515},{x:750,y:395},{x:750,y:575},{x:530,y:695}])i.fillRect(r.x,r.y,100,38);i.setDepth(.5);for(const r of[{x:160,y:450},{x:680,y:430},{x:950,y:780}])this.add.rectangle(r.x,r.y,14,18,2775594).setDepth(r.y+9),this.add.rectangle(r.x,r.y-7,16,5,1722906).setDepth(r.y+12),this.add.rectangle(r.x,r.y-5,14,2,3828282).setDepth(r.y+13);for(const r of[{x:155,y:460},{x:590,y:440},{x:720,y:460},{x:900,y:830}]){this.add.rectangle(r.x,r.y+8,4,30,3815994).setDepth(r.y+10),this.add.rectangle(r.x,r.y+22,10,5,3158064).setDepth(r.y+22),this.add.rectangle(r.x,r.y-8,14,6,3815994).setDepth(r.y-5),this.add.rectangle(r.x,r.y-4,12,5,16777130).setDepth(r.y-4);const o=this.add.graphics();o.fillStyle(16777164,.08),o.fillCircle(r.x,r.y,28),o.setDepth(r.y-6)}const s=this.add.graphics();s.fillStyle(16777215),s.fillEllipse(890,150,18,11),s.fillStyle(15649792),s.fillCircle(900,146,6),s.fillStyle(16746496),s.fillRect(905,145,5,2),s.fillStyle(14540253),s.fillEllipse(886,150,10,7),s.fillStyle(0),s.fillCircle(902,144,1),s.lineStyle(1,3381691,.4),s.strokeEllipse(892,152,28,10),s.strokeEllipse(892,152,36,14),s.setDepth(150);const l=this.add.graphics();l.fillStyle(13386820),l.fillRect(310,800,70,50),l.fillStyle(8926003,.6);for(let r=0;r<5;r++)l.fillRect(310+r*14,800,3,50);for(let r=0;r<4;r++)l.fillRect(310,800+r*12,70,3);l.fillStyle(15654365);for(let r=0;r<5;r++)l.fillRect(314+r*14,849,4,6);l.setDepth(.55),this.add.rectangle(490,380,3,28,4864536).setDepth(394),this.add.rectangle(490,366,48,26,15786176).setDepth(395),this.add.rectangle(490,366,44,22,2250154).setDepth(396),this.add.text(490,366,`CITY PARK
★ MAP ★`,{fontSize:"7px",color:"#ffffff",align:"center"}).setOrigin(.5).setDepth(397)}buildDecorativesCity(){const t=this.add.graphics();t.fillStyle(16763904);for(const l of[400,790])for(let r=80;r<940;r+=32)t.fillRect(l-1,r,3,18);for(let l=80;l<1200;l+=32)t.fillRect(l,479,18,3);t.setDepth(.6);const e=this.add.graphics();e.fillStyle(16777215,.75);for(let l=0;l<5;l++)e.fillRect(330+l*8,460,5,18),e.fillRect(330+l*8,500,5,18);for(let l=0;l<5;l++)e.fillRect(720+l*8,460,5,18),e.fillRect(720+l*8,500,5,18);e.setDepth(.61);const i=this.add.graphics();i.fillStyle(16777215,.4);for(let l=160;l<360;l+=50)i.fillRect(330,l,40,2);for(let l=600;l<800;l+=50)i.fillRect(330,l,40,2);i.setDepth(.62);const s=this.add.graphics();s.lineStyle(3,8947848,.8);for(const l of this.cfg.furniture.filter(r=>r.textureKey==="city-building"))s.strokeRect(l.rect.x-2,l.rect.y-2,l.rect.w+4,l.rect.h+4);s.setDepth(.7);for(const l of[{x:375,y:120},{x:375,y:380},{x:375,y:640},{x:685,y:120},{x:685,y:380},{x:685,y:640},{x:895,y:380},{x:895,y:640}]){this.add.rectangle(l.x,l.y,4,24,4210752).setDepth(l.y+12),this.add.rectangle(l.x+4,l.y-12,12,4,4210752).setDepth(l.y),this.add.rectangle(l.x+9,l.y-12,8,6,3158064).setDepth(l.y+1),this.add.rectangle(l.x+9,l.y-9,6,4,16777130).setDepth(l.y+2);const r=this.add.graphics();r.fillStyle(16777164,.06),r.fillEllipse(l.x+9,l.y+8,40,20),r.setDepth(.63)}for(const l of[{x:338,y:138},{x:338,y:380},{x:678,y:138},{x:678,y:380},{x:900,y:575},{x:480,y:840}])this.add.rectangle(l.x,l.y+3,9,12,13378082).setDepth(l.y+9),this.add.rectangle(l.x,l.y-3,11,5,11147288).setDepth(l.y+11),this.add.rectangle(l.x-5,l.y+3,4,4,14496563).setDepth(l.y+10),this.add.rectangle(l.x+5,l.y+3,4,4,14496563).setDepth(l.y+10),this.add.rectangle(l.x,l.y+10,12,3,8919064).setDepth(l.y+8),this.add.rectangle(l.x-5,l.y+3,2,2,13421772).setDepth(l.y+11),this.add.rectangle(l.x+5,l.y+3,2,2,13421772).setDepth(l.y+11);this.add.rectangle(460,848,3,14,3158064).setDepth(856),this.add.rectangle(460,840,18,12,1721514).setDepth(858),this.add.rectangle(460,835,18,5,2250188).setDepth(859),this.add.rectangle(462,840,2,12,3368669).setDepth(860),this.add.rectangle(455,843,3,2,8947848).setDepth(861);for(const l of[{x:326,y:118},{x:680,y:118},{x:880,y:374}]){this.add.rectangle(l.x,l.y+8,2,18,5263440).setDepth(l.y+16);const r=this.add.graphics();r.fillStyle(13373713),r.fillCircle(l.x,l.y-2,9),r.fillStyle(16777215),r.fillCircle(l.x,l.y-2,7),r.fillStyle(13373713),r.fillCircle(l.x,l.y-2,6),r.setDepth(l.y+10),this.add.text(l.x,l.y-2,"STOP",{fontSize:"4px",color:"#ffffff"}).setOrigin(.5).setDepth(l.y+11)}for(const l of[{x:350,y:368},{x:350,y:572},{x:700,y:368},{x:700,y:572},{x:480,y:860},{x:792,y:860}])this.add.rectangle(l.x,l.y+2,10,14,4473924).setDepth(l.y+9),this.add.rectangle(l.x,l.y-5,12,4,3355443).setDepth(l.y+12),this.add.rectangle(l.x+3,l.y-2,2,10,5592405).setDepth(l.y+10)}wireCollisions(){this.physics.add.collider(this.player.sprite,this.wallGroup),this.physics.add.collider(this.player.sprite,this.furnitureGroup),this.physics.add.collider(this.enemy.sprite,this.wallGroup),this.physics.add.collider(this.enemy.sprite,this.furnitureGroup),this.enemy2&&(this.physics.add.collider(this.enemy2.sprite,this.wallGroup),this.physics.add.collider(this.enemy2.sprite,this.furnitureGroup),this.physics.add.overlap(this.enemy2.sprite,this.player.poops,(t,e)=>{e.destroy(),this.enemy2.stun()}),this.physics.add.overlap(this.player.sprite,this.enemy2.sprite,()=>this.triggerLose())),this.physics.add.overlap(this.player.sprite,this.pinkTreatGroup,(t,e)=>{var r;if(this.axol)return;const i=e;(r=i.getData("emitter"))==null||r.destroy();const s=i.x,l=i.y;i.destroy(),this.spawnAxol(s,l)}),this.physics.add.overlap(this.player.sprite,this.treatGroup,(t,e)=>{var s;const i=e;(s=i.getData("emitter"))==null||s.destroy(),i.destroy(),this.player.collectTreat(),this.cache.audio.exists("crunch")&&this.sound.play("crunch",{volume:.6}),this.player.getTreatCount()>=this.cfg.totalTreats&&this.triggerWin()}),this.physics.add.overlap(this.enemy.sprite,this.player.poops,(t,e)=>{e.destroy(),this.enemy.stun()}),this.physics.add.overlap(this.player.sprite,this.enemy.sprite,()=>this.triggerLose())}triggerWin(){var t,e;this.isGameOver||(this.isGameOver=!0,(t=this.axol)==null||t.poof(),this.axol=null,this.player.sprite.setVelocity(0,0),(e=this.audioManager)==null||e.stop(),this.levelNum>=b.length?this.ui.showWin(this):this.time.delayedCall(400,()=>this.scene.start("TransitionScene",{completedLevel:this.levelNum})))}triggerLose(){var t,e;this.isGameOver||(this.isGameOver=!0,(t=this.axol)==null||t.poof(),this.axol=null,this.player.sprite.setVelocity(0,0),(e=this.audioManager)==null||e.stop(),this.ui.showLose(this))}buildPinkTreat(){const e={1:{x:450,y:350},2:{x:700,y:650},3:{x:640,y:650},4:{x:600,y:480}}[this.levelNum]??{x:300,y:300},i=16,s=160,l=[];for(let p=-s;p<=s;p+=i)for(let f=-s;f<=s;f+=i)l.push([f,p]);l.sort(([p,f],[w,d])=>p*p+f*f-w*w-d*d);let r=e.x,o=e.y;for(const[p,f]of l)if(this.isWalkable(e.x+p,e.y+f)){r=e.x+p,o=e.y+f;break}const h=this.pinkTreatGroup.create(r,o,"pink-treat");h.setDepth(9992),h.refreshBody();const a=this.add.particles(r,o,"sparkle",{lifespan:900,speed:{min:15,max:35},scale:{start:.7,end:0},alpha:{start:.9,end:0},tint:16746700,quantity:1,frequency:700,blendMode:u.BlendModes.ADD});a.setDepth(9993),h.setData("emitter",a),this.pinkTreatGroup.refresh()}spawnAxol(t,e){this.axol=new Q(this,t,e);const i=[...this.cfg.walls,...this.cfg.furniture.map(s=>s.rect)];this.axol.setObstacles(i),this.wireAxolCollisions()}wireAxolCollisions(){const t=this.axol;this.physics.add.collider(t.sprite,this.wallGroup),this.physics.add.collider(t.sprite,this.furnitureGroup),this.physics.add.overlap(t.sprite,this.treatGroup,(i,s)=>{var r,o;if(this.isGameOver||!((r=this.axol)!=null&&r.isAlive()))return;const l=s;(o=l.getData("emitter"))==null||o.destroy(),l.destroy(),this.player.collectTreat(),this.cache.audio.exists("crunch")&&this.sound.play("crunch",{volume:.35}),this.player.getTreatCount()>=this.cfg.totalTreats&&this.triggerWin()});const e=()=>{var i;(i=this.axol)!=null&&i.isAlive()&&(this.axol.poof(),this.axol=null)};this.physics.add.overlap(this.enemy.sprite,t.sprite,e),this.enemy2&&this.physics.add.overlap(this.enemy2.sprite,t.sprite,e)}addStaticRect(t,e,i){const s=e.x+e.w/2,l=e.y+e.h/2,r=t.create(s,l,i);r.setDisplaySize(e.w,e.h),r.refreshBody(),r.setDepth(e.y+e.h/2)}isWalkable(t,e){if(t<0||t>this.cfg.worldWidth||e<0||e>this.cfg.worldHeight)return!1;const i=14;for(const s of[...this.cfg.walls,...this.cfg.furniture.map(l=>l.rect)])if(t>=s.x-i&&t<=s.x+s.w+i&&e>=s.y-i&&e<=s.y+s.h+i)return!1;return!0}ensureTexture(t,e,i,s){if(this.textures.exists(t))return;const l=this.add.graphics();s(l),l.generateTexture(t,e,i),l.destroy()}}class g extends u.Scene{constructor(){super({key:"TransitionScene"});y(this,"completedLevel",1)}init(t){this.completedLevel=t.completedLevel}create(){const t=this.completedLevel+1,e=b[t-1],i=this.scale.width,s=this.scale.height;this.add.rectangle(i/2,s/2,i,s,657946),this.add.text(i/2,s/2-130,`Level ${this.completedLevel} Complete!`,{fontSize:"44px",color:"#00ff88",stroke:"#000000",strokeThickness:5}).setOrigin(.5),this.add.text(i/2,s/2-60,`Next: Level ${t} — ${e.name}`,{fontSize:"28px",color:"#ffffcc",stroke:"#000000",strokeThickness:3}).setOrigin(.5);let l=5;const r=this.add.text(i/2,s/2+20,`Starting in ${l}...`,{fontSize:"18px",color:"#aaaaaa"}).setOrigin(.5);this.time.addEvent({delay:1e3,repeat:4,callback:()=>{l--,r.setText(l>0?`Starting in ${l}...`:"Starting...")}});const o=this.add.text(i/2,s/2+100,`[ Play Level ${t} → ]`,{fontSize:"26px",color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5).setInteractive({useHandCursor:!0});o.on("pointerover",()=>o.setStyle({color:"#ffff00"})),o.on("pointerout",()=>o.setStyle({color:"#ffffff"})),o.on("pointerdown",()=>this.startNext()),this.time.delayedCall(5e3,()=>this.startNext())}startNext(){this.scene.start("GameScene",{level:this.completedLevel+1})}}const tt={type:u.AUTO,width:800,height:600,backgroundColor:"#1a1a2e",parent:document.body,physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scene:[B,x,g]};new u.Game(tt);
